<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fpocket: mdpocket.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<img src="fpocket_logo_small.png" width="545" height="150">
<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>mdpocket.h File Reference</h1><code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include &quot;<a class="el" href="fpocket_8h-source.html">fpocket.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="fpout_8h-source.html">fpout.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="writepocket_8h-source.html">writepocket.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="tpocket_8h-source.html">tpocket.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="dparams_8h-source.html">dparams.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="descriptors_8h-source.html">descriptors.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="neighbor_8h-source.html">neighbor.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="pocket_8h-source.html">pocket.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cluster_8h-source.html">cluster.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="refine_8h-source.html">refine.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="aa_8h-source.html">aa.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="calc_8h-source.html">calc.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="mdparams_8h-source.html">mdparams.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="mdpbase_8h-source.html">mdpbase.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="memhandler_8h-source.html">memhandler.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="mdpout_8h-source.html">mdpout.h</a>&quot;</code><br>

<p>
<a href="mdpocket_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#aa6ae54a26dc2c17e82f8f9aa698d33a">M_MDP_OUTP_HEADER</a>&nbsp;&nbsp;&nbsp;&quot;snapshot pock_volume pock_asa pock_pol_asa pock_apol_asa pock_asa22 pock_pol_asa22 pock_apol_asa22 nb_AS mean_as_ray mean_as_solv_acc apol_as_prop mean_loc_hyd_dens hydrophobicity_score volume_score polarity_score charge_score prop_polar_atm as_density as_max_dst&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#141569352ac6498ef600013955976332">M_MDP_OUTP_FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%d %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %d %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %d %d %4.2f %4.2f %4.2f&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#d0e042551854d85953e19f8610e75ff0">M_MDP_OUTP_VAR</a>(i, d)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#61097eddcc55b9d7f6d44efd1ab95111">mdpocket_detect</a> (<a class="el" href="structs__mdparams.html">s_mdparams</a> *par)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#3fec6dfd2b4a5dbb7fb8250d9e18a576">mdprocess_pdb</a> (<a class="el" href="structs__pdb.html">s_pdb</a> *pdb, <a class="el" href="structs__mdparams.html">s_mdparams</a> *mdparams, FILE *pqrout, int snnumber)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#c16993d49e04a0873a2b3fad3caf2f29">mdpocket_characterize</a> (<a class="el" href="structs__mdparams.html">s_mdparams</a> *par)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__pocket.html">s_pocket</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#9345e7031a968f666fe94fce50da04e6">extract_wanted_vertices</a> (<a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets, <a class="el" href="structs__pdb.html">s_pdb</a> *pdb)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#fa4a82c86986d942b9eb16f0ce4ac776">open_pdb_file</a> (char *pdbname)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#b2fe52fe7d891aea86403c98812cbe07">write_md_descriptors</a> (FILE *f, <a class="el" href="structs__pocket.html">s_pocket</a> *p, int i)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdpocket_8h.html#418fae61b2e301688f44b2694892b140">get_wanted_atom_ids</a> (<a class="el" href="structs__pdb.html">s_pdb</a> *prot, <a class="el" href="structs__pdb.html">s_pdb</a> *pocket, int *n)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="141569352ac6498ef600013955976332"></a><!-- doxytag: member="mdpocket.h::M_MDP_OUTP_FORMAT" ref="141569352ac6498ef600013955976332" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_MDP_OUTP_FORMAT&nbsp;&nbsp;&nbsp;&quot;%d %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %d %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %d %d %4.2f %4.2f %4.2f&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
format for the dpocket output 
<p>Definition at line <a class="el" href="mdpocket_8h-source.html#l00065">65</a> of file <a class="el" href="mdpocket_8h-source.html">mdpocket.h</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00313">write_md_descriptors()</a>.</p>

</div>
</div><p>
<a class="anchor" name="aa6ae54a26dc2c17e82f8f9aa698d33a"></a><!-- doxytag: member="mdpocket.h::M_MDP_OUTP_HEADER" ref="aa6ae54a26dc2c17e82f8f9aa698d33a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_MDP_OUTP_HEADER&nbsp;&nbsp;&nbsp;&quot;snapshot pock_volume pock_asa pock_pol_asa pock_apol_asa pock_asa22 pock_pol_asa22 pock_apol_asa22 nb_AS mean_as_ray mean_as_solv_acc apol_as_prop mean_loc_hyd_dens hydrophobicity_score volume_score polarity_score charge_score prop_polar_atm as_density as_max_dst&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
header for the dpocket output 
<p>Definition at line <a class="el" href="mdpocket_8h-source.html#l00064">64</a> of file <a class="el" href="mdpocket_8h-source.html">mdpocket.h</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d0e042551854d85953e19f8610e75ff0"></a><!-- doxytag: member="mdpocket.h::M_MDP_OUTP_VAR" ref="d0e042551854d85953e19f8610e75ff0" args="(i, d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_MDP_OUTP_VAR          </td>
          <td>(</td>
          <td class="paramtype">i,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">d&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">i, d-&gt;volume, \
                              d-&gt;surf_vdw14, \
                              d-&gt;surf_pol_vdw14, \
                              d-&gt;surf_apol_vdw14, \
                              d-&gt;surf_vdw22, \
                              d-&gt;surf_pol_vdw22, \
                              d-&gt;surf_apol_vdw22, \
                              d-&gt;nb_asph,\
                              d-&gt;mean_asph_ray, \
                              d-&gt;masph_sacc, \
                              d-&gt;apolar_asphere_prop, \
                              d-&gt;mean_loc_hyd_dens, \
                              d-&gt;hydrophobicity_score, \
                              d-&gt;volume_score, \
                              d-&gt;polarity_score, \
                              d-&gt;charge_score, \
                              d-&gt;prop_polar_atm, \
                              d-&gt;as_density, \
                              d-&gt;as_max_dst
</pre></div>list of descriptors to output in the dpocket output 
<p>Definition at line <a class="el" href="mdpocket_8h-source.html#l00066">66</a> of file <a class="el" href="mdpocket_8h-source.html">mdpocket.h</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00313">write_md_descriptors()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9345e7031a968f666fe94fce50da04e6"></a><!-- doxytag: member="mdpocket.h::extract_wanted_vertices" ref="9345e7031a968f666fe94fce50da04e6" args="(c_lst_pockets *pockets, s_pdb *pdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__pocket.html">s_pocket</a>* extract_wanted_vertices           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *&nbsp;</td>
          <td class="paramname"> <em>pockets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>pdb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: extract_wanted_vertices<p>
## SPECIFICATION: Return a pocket structure containing all vertices that are nearby the wanted zone given in the input file<p>
## PARAMETRES: @ <a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets : Chained list of pockets found in the current Snapshot @ <a class="el" href="structs__pdb.html">s_pdb</a> *pdb : The wanted vertices in a pdb structure handle<p>
## RETURN: <a class="el" href="structs__pocket.html">s_pocket</a> * : One pocket containing all interesting vertices 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00339">339</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="pocket_8c-source.html#l01137">alloc_pocket()</a>, <a class="el" href="voronoi__lst_8c-source.html#l00154">c_lst_vertices_add_last()</a>, <a class="el" href="voronoi__lst_8c-source.html#l00071">c_lst_vertices_alloc()</a>, <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="pocket_8h-source.html#l00089">c_lst_pockets::first</a>, <a class="el" href="pocket_8c-source.html#l01369">get_pocket_pvertices()</a>, <a class="el" href="rpdb_8h-source.html#l00074">s_pdb::latoms_p</a>, <a class="el" href="mdpbase_8h-source.html#l00065">M_MDP_CUBE_SIDE</a>, <a class="el" href="voronoi__lst_8h-source.html#l00067">c_lst_vertices::n_vertices</a>, <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natoms</a>, <a class="el" href="pocket_8h-source.html#l00080">node_pocket::next</a>, <a class="el" href="pocket_8h-source.html#l00082">node_pocket::pocket</a>, <a class="el" href="pocket_8h-source.html#l00063">s_pocket::v_lst</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::y</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, <a class="el" href="voronoi_8h-source.html#l00076">s_vvertice::z</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00339"></a>00339                                                                     {
<a name="l00340"></a>00340     <a class="code" href="structs__pocket.html">s_pocket</a> *p=<a class="code" href="pocket_8c.html#cf6323521d0c1e5de5898a40fc27477b">alloc_pocket</a>();     <span class="comment">/*alloc memory for a new pocket*/</span>
<a name="l00341"></a>00341     p-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>=<a class="code" href="voronoi__lst_8c.html#53a8c365051d6789c729a1341cdbe9bf">c_lst_vertices_alloc</a>();    <span class="comment">/*alloc memory for vertices in new pocket*/</span>
<a name="l00342"></a>00342     <a class="code" href="structs__pocket.html">s_pocket</a> *cp=NULL;              <span class="comment">/*just a handler for the chained list navigation*/</span>
<a name="l00343"></a>00343     <a class="code" href="structnode__pocket.html">node_pocket</a> *cur = NULL ;   <span class="comment">/*again just a handler for navigation*/</span>
<a name="l00344"></a>00344     cur = pockets-&gt;<a class="code" href="structc__lst__pockets.html#cf82eb35ce757228759a9af7675f5ad9">first</a> ;      <span class="comment">/*get the first pocket in the chained list*/</span>
<a name="l00345"></a>00345     <a class="code" href="structs__vvertice.html">s_vvertice</a>** pverts=NULL;   <span class="comment">/*define a vertice object*/</span>
<a name="l00346"></a>00346     <span class="keywordtype">size_t</span> i;
<a name="l00347"></a>00347     <span class="keywordtype">int</span> z;
<a name="l00348"></a>00348     <a class="code" href="structs__atm.html">s_atm</a> *cura=NULL;
<a name="l00349"></a>00349     <span class="keywordflow">while</span>(cur) {                <span class="comment">/*loop over all snapshot pockets*/</span>
<a name="l00350"></a>00350         cp=cur-&gt;<a class="code" href="structnode__pocket.html#8dbdbb50f893fa45bba2d8c03aff6553">pocket</a>;
<a name="l00351"></a>00351         pverts=<a class="code" href="pocket_8c.html#86288d8af02eeeb7c4a1b18df3a82af3">get_pocket_pvertices</a>(cp); <span class="comment">/*get the current pocket vertices*/</span>
<a name="l00352"></a>00352         <span class="keywordflow">for</span>(i=0;i&lt;cp-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>-&gt;<a class="code" href="structc__lst__vertices.html#390c82c4f8bf495bdaf9c8ea95863c17">n_vertices</a>;i++){   <span class="comment">/*loop over these vertices*/</span>
<a name="l00353"></a>00353             <span class="keywordflow">for</span>(z=0;z&lt;pdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>;z++){         <span class="comment">/*loop over wanted vertices*/</span>
<a name="l00354"></a>00354                 cura=pdb-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>[z];          <span class="comment">/*get wanted vertice in an atom object*/</span>
<a name="l00355"></a>00355                 <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>,cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>,cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>,pverts[i]-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>,pverts[i]-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>,pverts[i]-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>)&lt;=(<span class="keywordtype">float</span>)<a class="code" href="mdpbase_8h.html#6ac8f76875e6adfaafa8b21413658576">M_MDP_CUBE_SIDE</a>/2.0){
<a name="l00356"></a>00356                     <a class="code" href="voronoi__lst_8c.html#7a236c6cd9144562b9bb7885ca7eb6c4">c_lst_vertices_add_last</a>(p-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>, pverts[i]);   <span class="comment">/*if the current vertice is near the wanted one, add it to the new pocket*/</span>
<a name="l00357"></a>00357                 }
<a name="l00358"></a>00358             }
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360         cur=cur-&gt;<a class="code" href="structnode__pocket.html#a33c910dd9e6996001374199f250267e">next</a>;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">return</span>(p);
<a name="l00363"></a>00363 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="418fae61b2e301688f44b2694892b140"></a><!-- doxytag: member="mdpocket.h::get_wanted_atom_ids" ref="418fae61b2e301688f44b2694892b140" args="(s_pdb *prot, s_pdb *pocket, int *n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* get_wanted_atom_ids           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>prot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>pocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>n</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: get_wanted_atom_ids<p>
## SPECIFICATION: Given an input pocket by the user, this function returns all atoms on the protein that are nearby (usually on the first snapshot). This is useful for the output of the pocket motions<p>
## PARAMETRES: @ <a class="el" href="structs__pdb.html">s_pdb</a> *prot : Protein structure @ <a class="el" href="structs__pdb.html">s_pdb</a> *pocket : The pocket (grid points) organized as <a class="el" href="structs__pdb.html">s_pdb</a> structure @ int *n : Pointer to int storing the number of atoms that are selected by this function.<p>
## RETURN: int * : List of atom ids 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00386">386</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="calc_8c-source.html#l00075">dist()</a>, <a class="el" href="atom_8h-source.html#l00063">s_atm::id</a>, <a class="el" href="rpdb_8h-source.html#l00074">s_pdb::latoms_p</a>, <a class="el" href="mdpbase_8h-source.html#l00066">M_MDP_WP_ATOM_DIST</a>, <a class="el" href="memhandler_8c-source.html#l00121">my_malloc()</a>, <a class="el" href="memhandler_8c-source.html#l00184">my_realloc()</a>, <a class="el" href="rpdb_8h-source.html#l00078">s_pdb::natoms</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::x</a>, <a class="el" href="atom_8h-source.html#l00056">s_atm::y</a>, and <a class="el" href="atom_8h-source.html#l00056">s_atm::z</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00386"></a>00386                                                            {
<a name="l00387"></a>00387     <span class="keywordtype">int</span> *ids=(<span class="keywordtype">int</span> *)<a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00388"></a>00388     <span class="keywordtype">int</span> v,a;
<a name="l00389"></a>00389     *n=1;
<a name="l00390"></a>00390     <a class="code" href="structs__atm.html">s_atm</a> *cura=NULL;
<a name="l00391"></a>00391     <a class="code" href="structs__atm.html">s_atm</a> *curv=NULL;
<a name="l00392"></a>00392     <span class="keywordtype">int</span> flag=0;
<a name="l00393"></a>00393     <span class="keywordflow">for</span>(a=0;a&lt;prot-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>;a++){
<a name="l00394"></a>00394         cura=prot-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>[a];
<a name="l00395"></a>00395         v=0;
<a name="l00396"></a>00396         flag=0;
<a name="l00397"></a>00397         <span class="keywordflow">while</span>(flag==0 &amp;&amp; v&lt;pocket-&gt;natoms){
<a name="l00398"></a>00398             curv=pocket-&gt;<a class="code" href="structs__pdb.html#4517e3a82dbf0f34e73d1865e484dbfd">latoms_p</a>[v];
<a name="l00399"></a>00399             <span class="keywordflow">if</span>(<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>,cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>,cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>,curv-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>,curv-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>,curv-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>)&lt;=<a class="code" href="mdpbase_8h.html#1a337d773f7acc3979583cde674cd8aa">M_MDP_WP_ATOM_DIST</a>){
<a name="l00400"></a>00400                 ids[*n-1]=cura-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>;
<a name="l00401"></a>00401                 *n=*n+1;
<a name="l00402"></a>00402                 ids=(<span class="keywordtype">int</span> *)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(ids,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(*n));
<a name="l00403"></a>00403                 flag=1;
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             v++;
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408     <span class="keywordflow">return</span>(ids);
<a name="l00409"></a>00409     
<a name="l00410"></a>00410 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c16993d49e04a0873a2b3fad3caf2f29"></a><!-- doxytag: member="mdpocket.h::mdpocket_characterize" ref="c16993d49e04a0873a2b3fad3caf2f29" args="(s_mdparams *par)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdpocket_characterize           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__mdparams.html">s_mdparams</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: mdpocket_characterize<p>
## SPECIFICATION: Mdpocket main function. Simple loop is performed over all files.<p>
## PARAMETRES: @ <a class="el" href="structs__mdparams.html">s_mdparams</a> *par: Parameters of the programm<p>
## RETURN: void TODO : tidy this function a bit up, maybe split it in subfunctions 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00217">217</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="pocket_8c-source.html#l01214">c_lst_pocket_free()</a>, <a class="el" href="pocket_8c-source.html#l00841">c_lst_pockets_add_last()</a>, <a class="el" href="pocket_8c-source.html#l01161">c_lst_pockets_alloc()</a>, <a class="el" href="mdpocket_8c-source.html#l00339">extract_wanted_vertices()</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_apdb</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_desc</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_ppdb</a>, <a class="el" href="voronoi__lst_8h-source.html#l00064">c_lst_vertices::first</a>, <a class="el" href="fparams_8h-source.html#l00139">s_fparams::flag_do_asa_and_volume_calculations</a>, <a class="el" href="mdparams_8h-source.html#l00138">s_mdparams::fpar</a>, <a class="el" href="rpdb_8h-source.html#l00070">s_pdb::fpdb</a>, <a class="el" href="rpdb_8c-source.html#l00794">free_pdb_atoms()</a>, <a class="el" href="mdparams_8h-source.html#l00125">s_mdparams::fsnapshot</a>, <a class="el" href="mdparams_8h-source.html#l00126">s_mdparams::fwantedpocket</a>, <a class="el" href="aa_8c-source.html#l00117">get_aa_name3()</a>, <a class="el" href="pocket_8c-source.html#l01269">get_pocket_contacted_atms()</a>, <a class="el" href="mdpocket_8c-source.html#l00386">get_wanted_atom_ids()</a>, <a class="el" href="rpdb_8h-source.html#l00050">M_DONT_KEEP_LIG</a>, <a class="el" href="mdpocket_8h-source.html#l00064">M_MDP_OUTP_HEADER</a>, <a class="el" href="mdpocket_8c-source.html#l00460">mdprocess_pdb()</a>, <a class="el" href="memhandler_8c-source.html#l00255">my_free()</a>, <a class="el" href="memhandler_8c-source.html#l00121">my_malloc()</a>, <a class="el" href="voronoi__lst_8h-source.html#l00067">c_lst_vertices::n_vertices</a>, <a class="el" href="fparams_8h-source.html#l00141">s_fparams::nb_mcv_iter</a>, <a class="el" href="voronoi__lst_8h-source.html#l00056">node_vertice::next</a>, <a class="el" href="mdparams_8h-source.html#l00137">s_mdparams::nfiles</a>, <a class="el" href="mdpocket_8c-source.html#l00426">open_pdb_file()</a>, <a class="el" href="pocket_8h-source.html#l00061">s_pocket::pdesc</a>, <a class="el" href="rpdb_8c-source.html#l00478">rpdb_open()</a>, <a class="el" href="rpdb_8c-source.html#l00599">rpdb_read()</a>, <a class="el" href="descriptors_8c-source.html#l00182">set_descriptors()</a>, <a class="el" href="pocket_8h-source.html#l00063">s_pocket::v_lst</a>, <a class="el" href="voronoi__lst_8h-source.html#l00058">node_vertice::vertice</a>, <a class="el" href="mdpocket_8c-source.html#l00313">write_md_descriptors()</a>, <a class="el" href="mdpout_8c-source.html#l00162">write_md_pocket_atoms()</a>, and <a class="el" href="voronoi_8c-source.html#l00651">write_pqr_vert()</a>.</p>

<p>Referenced by <a class="el" href="mdpmain_8c-source.html#l00068">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00218"></a>00218 {
<a name="l00219"></a>00219         <span class="keywordtype">int</span> i,natms,j;
<a name="l00220"></a>00220         FILE *null=fopen(<span class="stringliteral">"/dev/null"</span>,<span class="stringliteral">"w"</span>);                  <span class="comment">/*open a /dev/null redir for the pqr concat output*/</span>
<a name="l00221"></a>00221         FILE *descfile=NULL;                                <span class="comment">/*file handle for the descriptor file*/</span>
<a name="l00222"></a>00222         FILE *fout[2] ;
<a name="l00223"></a>00223         <span class="keywordtype">int</span> *wanted_atom_ids = NULL;
<a name="l00224"></a>00224         <span class="keywordtype">int</span> nwanted_atom_ids = 0;
<a name="l00225"></a>00225         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets=NULL;                        <span class="comment">/*handle for the pockets found in one snapshots*/</span>
<a name="l00226"></a>00226         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *mdpockets=<a class="code" href="pocket_8c.html#a27fe77f54f873cf74e9218c52237a79">c_lst_pockets_alloc</a>();     <span class="comment">/*handle for one pocket per snapshot in a chained list*/</span>
<a name="l00227"></a>00227         <a class="code" href="structs__pocket.html">s_pocket</a> *cpocket=NULL;                             <span class="comment">/*tmp for current pocket */</span>
<a name="l00228"></a>00228         <a class="code" href="structs__pdb.html">s_pdb</a> *wantedpocket =  <a class="code" href="rpdb_8c.html#29ed3bff6fdc59fd8bf806a35c3127d7">rpdb_open</a>(par-&gt;<a class="code" href="structs__mdparams.html#dd53661c05c03737c901218c723c7090">fwantedpocket</a>, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>);    <span class="comment">/*open in the reference pocket (grid points)*/</span>
<a name="l00229"></a>00229         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(wantedpocket, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;    <span class="comment">/*read this pocket*/</span>
<a name="l00230"></a>00230         <a class="code" href="structs__pdb.html">s_pdb</a> *cpdb=NULL;                                   <span class="comment">/*pdb handle for the current snapshot structure*/</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordflow">if</span>(par) {
<a name="l00233"></a>00233             descfile=fopen(par-&gt;<a class="code" href="structs__mdparams.html#fe7f72c27f0aae6fb9dec90d2f9b733f">f_desc</a>,<span class="stringliteral">"w"</span>);                <span class="comment">/*open the descriptor output file*/</span>
<a name="l00234"></a>00234             fout[0]=fopen(par-&gt;<a class="code" href="structs__mdparams.html#39b8c17e13f58bb3ee1c0ba7a1c70181">f_ppdb</a>,<span class="stringliteral">"w"</span>);
<a name="l00235"></a>00235             fout[1]=fopen(par-&gt;<a class="code" href="structs__mdparams.html#b151d80ca7f808eb4eccd5440352bf2d">f_apdb</a>,<span class="stringliteral">"w"</span>);
<a name="l00236"></a>00236             <span class="comment">/*print all the headers in this file*/</span>
<a name="l00237"></a>00237             fprintf(descfile,<a class="code" href="mdpocket_8h.html#aa6ae54a26dc2c17e82f8f9aa698d33a">M_MDP_OUTP_HEADER</a>);
<a name="l00238"></a>00238             <span class="keywordflow">for</span>( j = 0 ; j &lt; 20 ; j++ ) fprintf(descfile, <span class="stringliteral">" %s"</span>, <a class="code" href="aa_8c.html#f071a7d6353978202a07fd66f2ff68d8">get_aa_name3</a>(j));
<a name="l00239"></a>00239             fprintf(descfile, <span class="stringliteral">"\n"</span>);
<a name="l00240"></a>00240             
<a name="l00241"></a>00241             <span class="comment">/* Begins mdpocket */</span>
<a name="l00242"></a>00242             <span class="keywordflow">for</span>(i = 0 ; i &lt; par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a> ; i++) {            <span class="comment">/*loop over all snapshots*/</span>
<a name="l00243"></a>00243                     fprintf(stdout, <span class="stringliteral">"&lt;mdpocket&gt;s %d/%d - %s:"</span>,
<a name="l00244"></a>00244                                     i+1, par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>, par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]) ;
<a name="l00245"></a>00245                     fflush(stdout);
<a name="l00246"></a>00246                     fprintf(fout[0],<span class="stringliteral">"MODEL        %d\n"</span>,i);
<a name="l00247"></a>00247                     cpdb=<a class="code" href="mdpocket_8c.html#fa4a82c86986d942b9eb16f0ce4ac776">open_pdb_file</a>(par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]);                      <span class="comment">/*open the snapshot pdb handle*/</span>
<a name="l00248"></a>00248                     pockets=<a class="code" href="mdpocket_8c.html#3fec6dfd2b4a5dbb7fb8250d9e18a576">mdprocess_pdb</a>(cpdb, par,null,i+1);                  <span class="comment">/*perform pocket detection on the current snapshot*/</span>
<a name="l00249"></a>00249                     <span class="keywordflow">if</span>(i==0)wanted_atom_ids=<a class="code" href="mdpocket_8c.html#418fae61b2e301688f44b2694892b140">get_wanted_atom_ids</a>(cpdb,wantedpocket,&amp;nwanted_atom_ids);
<a name="l00250"></a>00250                     <a class="code" href="mdpout_8c.html#0dbb884a5127e78c096b8f654300e0aa">write_md_pocket_atoms</a>(fout[1],wanted_atom_ids,cpdb,nwanted_atom_ids, i);
<a name="l00251"></a>00251                     <span class="keywordflow">if</span>(pockets){
<a name="l00252"></a>00252                         cpocket=<a class="code" href="mdpocket_8c.html#9345e7031a968f666fe94fce50da04e6">extract_wanted_vertices</a>(pockets,wantedpocket);  <span class="comment">/*get only vertices in the interesting zone and put them together in one pocket*/</span>
<a name="l00253"></a>00253                         <a class="code" href="pocket_8c.html#54be6cfe4a41319d3b8500effcd40019">c_lst_pockets_add_last</a>(mdpockets,cpocket,0,0);          <span class="comment">/*add the pocket to the chained list (will contain the pocket over the md traj)*/</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                         <span class="comment">/*some tmp stuff following,TODO : put this in a function*/</span>
<a name="l00256"></a>00256                         <a class="code" href="structs__vvertice.html">s_vvertice</a> **tab_vert = (<a class="code" href="structs__vvertice.html">s_vvertice</a> **)
<a name="l00257"></a>00257                                         <a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(cpocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>-&gt;<a class="code" href="structc__lst__vertices.html#390c82c4f8bf495bdaf9c8ea95863c17">n_vertices</a>*<span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>*)) ;
<a name="l00258"></a>00258                         j = 0 ;
<a name="l00259"></a>00259                         <a class="code" href="structnode__vertice.html">node_vertice</a> *nvcur = cpocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>-&gt;<a class="code" href="structc__lst__vertices.html#72562067d308bcfcf32605e112e30c1a">first</a> ;
<a name="l00260"></a>00260                         <span class="keywordflow">while</span>(nvcur) {
<a name="l00261"></a>00261                                 <a class="code" href="voronoi_8c.html#0fc0360fbb0a071ba6d49dedd57ba397">write_pqr_vert</a>(fout[0], nvcur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a>) ;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                                 tab_vert[j] = nvcur-&gt;<a class="code" href="structnode__vertice.html#7e7063f6403dfd8f0a8f83462e27729b">vertice</a> ;
<a name="l00264"></a>00264                                 nvcur = nvcur-&gt;<a class="code" href="structnode__vertice.html#61b34ff349d05cc65a4d8b9e2c77ff3e">next</a> ;
<a name="l00265"></a>00265                                 j++ ;
<a name="l00266"></a>00266                         }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                         <span class="comment">/*get atoms contacted by the pocket*/</span>
<a name="l00269"></a>00269                         <a class="code" href="structs__atm.html">s_atm</a> **pocket_atoms = <a class="code" href="pocket_8c.html#38455bc09be1fc0f535f441d7b8eba40">get_pocket_contacted_atms</a>(cpocket, &amp;natms) ;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                         <span class="comment">/* Calculate descriptors*/</span>
<a name="l00272"></a>00272                         <a class="code" href="descriptors_8c.html#9cfae44d2e72d4c92d38a4b73538d8c4">set_descriptors</a>(pocket_atoms, natms, tab_vert,cpocket-&gt;<a class="code" href="structs__pocket.html#cf07f539404d23c1956373f8c93a4fcc">v_lst</a>-&gt;<a class="code" href="structc__lst__vertices.html#390c82c4f8bf495bdaf9c8ea95863c17">n_vertices</a>, cpocket-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>,par-&gt;<a class="code" href="structs__mdparams.html#330ea7d574bd29f9925fd7902f74b6c5">fpar</a>-&gt;<a class="code" href="structs__fparams.html#8caeadbae2db7d24763497290e6b9220">nb_mcv_iter</a>,cpdb,par-&gt;<a class="code" href="structs__mdparams.html#330ea7d574bd29f9925fd7902f74b6c5">fpar</a>-&gt;<a class="code" href="structs__fparams.html#771a10e1c94346d353eb6cb87b4abb18">flag_do_asa_and_volume_calculations</a>) ;
<a name="l00273"></a>00273                         <a class="code" href="mdpocket_8c.html#b2fe52fe7d891aea86403c98812cbe07">write_md_descriptors</a>(descfile,cpocket,i+1); <span class="comment">/*write MD descriptors to the descriptor output file*/</span>
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(pocket_atoms) ;     <span class="comment">/*free current pocket atoms*/</span>
<a name="l00276"></a>00276                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(tab_vert) ;         <span class="comment">/*free tmp vertice tab*/</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278                     }
<a name="l00279"></a>00279                     <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb);           <span class="comment">/*free memory of the current snapshot atoms*/</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                     <span class="comment">/*just some stupid print to stdout things*/</span>
<a name="l00282"></a>00282                     <span class="keywordflow">if</span>(i == par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a> - 1) fprintf(stdout,<span class="stringliteral">"\n"</span>) ;
<a name="l00283"></a>00283                     <span class="keywordflow">else</span> fprintf(stdout,<span class="stringliteral">"\r"</span>) ;
<a name="l00284"></a>00284                     fflush(stdout);
<a name="l00285"></a>00285                     fprintf(fout[0],<span class="stringliteral">"ENDMDL\n\n"</span>);
<a name="l00286"></a>00286                     <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets);     <span class="comment">/*free pockets of current snapshot*/</span>
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289             fclose(descfile);                       <span class="comment">/*close the descriptor output file handle*/</span>
<a name="l00290"></a>00290             <span class="comment">/*free_mdconcat(mdconcat);*/</span> <span class="comment">/*should be freed by free_all*/</span>
<a name="l00291"></a>00291             <span class="keywordflow">for</span>( i = 0 ; i &lt; 2 ; i++ ) fclose(fout[i]) ;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293         fclose(wantedpocket-&gt;<a class="code" href="structs__pdb.html#ee6f65655c18f873a00ab5ab376c84c7">fpdb</a>);
<a name="l00294"></a>00294         fclose(null);                               <span class="comment">/*close the /dev/null file handle*/</span>
<a name="l00295"></a>00295 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="61097eddcc55b9d7f6d44efd1ab95111"></a><!-- doxytag: member="mdpocket.h::mdpocket_detect" ref="61097eddcc55b9d7f6d44efd1ab95111" args="(s_mdparams *par)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mdpocket_detect           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__mdparams.html">s_mdparams</a> *&nbsp;</td>
          <td class="paramname"> <em>par</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: mdpocket_detect<p>
## SPECIFICATION: Mdpocket main function. Perform pocket detection on all snapshots. Pockets will be merged in one single output file mdpout_concat.pqr and a grid file will be produced, containing Voronoi vertice densities on grid point positions<p>
## PARAMETRES: @ <a class="el" href="structs__mdparams.html">s_mdparams</a> *par: Parameters of the programm<p>
## RETURN: void 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00089">89</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="mdparams_8h-source.html#l00140">s_mdparams::bfact_on_all</a>, <a class="el" href="pocket_8c-source.html#l01214">c_lst_pocket_free()</a>, <a class="el" href="mdpbase_8c-source.html#l00104">calculate_md_dens_grid()</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_appdb</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_densdx</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_densiso</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_freqdx</a>, <a class="el" href="mdparams_8h-source.html#l00128">s_mdparams::f_freqiso</a>, <a class="el" href="fparams_8h-source.html#l00139">s_fparams::flag_do_asa_and_volume_calculations</a>, <a class="el" href="mdparams_8h-source.html#l00138">s_mdparams::fpar</a>, <a class="el" href="rpdb_8c-source.html#l00794">free_pdb_atoms()</a>, <a class="el" href="mdparams_8h-source.html#l00125">s_mdparams::fsnapshot</a>, <a class="el" href="mdpbase_8c-source.html#l00438">init_md_grid()</a>, <a class="el" href="rpdb_8h-source.html#l00050">M_DONT_KEEP_LIG</a>, <a class="el" href="mdparams_8h-source.html#l00071">M_MDP_DEFAULT_ISO_VALUE_DENS</a>, <a class="el" href="mdparams_8h-source.html#l00070">M_MDP_DEFAULT_ISO_VALUE_FREQ</a>, <a class="el" href="mdpocket_8c-source.html#l00460">mdprocess_pdb()</a>, <a class="el" href="mdpbase_8h-source.html#l00090">s_mdgrid::n_snapshots</a>, <a class="el" href="mdparams_8h-source.html#l00137">s_mdparams::nfiles</a>, <a class="el" href="mdpbase_8c-source.html#l00348">normalize_grid()</a>, <a class="el" href="mdpocket_8c-source.html#l00426">open_pdb_file()</a>, <a class="el" href="mdpbase_8c-source.html#l00295">project_grid_on_atoms()</a>, <a class="el" href="utils_8c-source.html#l00678">remove_ext()</a>, <a class="el" href="utils_8c-source.html#l00638">remove_path()</a>, <a class="el" href="mdpbase_8c-source.html#l00269">reset_grid()</a>, <a class="el" href="rpdb_8c-source.html#l00599">rpdb_read()</a>, <a class="el" href="mdpbase_8c-source.html#l00184">update_md_grid()</a>, <a class="el" href="mdpout_8c-source.html#l00203">write_first_bfactor_density()</a>, and <a class="el" href="mdpout_8c-source.html#l00095">write_md_grid()</a>.</p>

<p>Referenced by <a class="el" href="mdpmain_8c-source.html#l00068">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091         <span class="keywordtype">int</span> i;
<a name="l00092"></a>00092         FILE *fout[6] ;                             <span class="comment">/*output file handles*/</span>
<a name="l00093"></a>00093         FILE *timef;                                <span class="comment">/*just an output for performance measurements*/</span>
<a name="l00094"></a>00094         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets=NULL;                <span class="comment">/*tmp handle for pockets*/</span>
<a name="l00095"></a>00095         <a class="code" href="structs__mdgrid.html">s_mdgrid</a> *freqgrid=NULL;                      <span class="comment">/*init mdgrid structure*/</span>
<a name="l00096"></a>00096         <a class="code" href="structs__mdgrid.html">s_mdgrid</a> *refgrid=NULL;                     <span class="comment">/*reference grid*/</span>
<a name="l00097"></a>00097         <a class="code" href="structs__mdgrid.html">s_mdgrid</a> *densgrid=NULL;                    <span class="comment">/*density grid*/</span>
<a name="l00098"></a>00098         <a class="code" href="structs__pdb.html">s_pdb</a> *cpdb=NULL;                           <span class="comment">/*handle for the current snapshot structure*/</span>
<a name="l00099"></a>00099         par-&gt;<a class="code" href="structs__mdparams.html#330ea7d574bd29f9925fd7902f74b6c5">fpar</a>-&gt;<a class="code" href="structs__fparams.html#771a10e1c94346d353eb6cb87b4abb18">flag_do_asa_and_volume_calculations</a>=0; <span class="comment">/*don't do ASA and volume calculations here as they are expensive and we don't need the results here*/</span>
<a name="l00100"></a>00100         FILE *cf;                                   <span class="comment">/*file handle for current bfact coloured file to write*/</span>
<a name="l00101"></a>00101         <span class="keywordtype">char</span> cf_name[350] = <span class="stringliteral">""</span> ;
<a name="l00102"></a>00102         <span class="keywordtype">char</span> pdb_code[350] = <span class="stringliteral">""</span> ;
<a name="l00103"></a>00103         <span class="keywordflow">if</span>(par) {
<a name="l00104"></a>00104         <span class="comment">/* Opening output files */</span>
<a name="l00105"></a>00105                 <span class="comment">//fout[0] = fopen(par-&gt;f_pqr,"w") ;   /*concat pqr output*/</span>
<a name="l00106"></a>00106                 fout[1] = fopen(par-&gt;<a class="code" href="structs__mdparams.html#25e78e742e6058ece1232bac0cdb9846">f_freqdx</a>,<span class="stringliteral">"w"</span>) ;    <span class="comment">/*grid dx output*/</span>
<a name="l00107"></a>00107                 fout[2] = fopen(par-&gt;<a class="code" href="structs__mdparams.html#e7f5535dcb3fbfc98f28512d6f34ff75">f_densdx</a>,<span class="stringliteral">"w"</span>) ;    <span class="comment">/*grid dx output*/</span>
<a name="l00108"></a>00108                 fout[3] = fopen(par-&gt;<a class="code" href="structs__mdparams.html#c9b285b02ee9843e17d4fb939c8edc6d">f_freqiso</a>,<span class="stringliteral">"w"</span>) ;   <span class="comment">/*iso pdb output*/</span>
<a name="l00109"></a>00109                 fout[4] = fopen(par-&gt;<a class="code" href="structs__mdparams.html#b42369a835562016d522435e542fdf82">f_densiso</a>,<span class="stringliteral">"w"</span>) ;   <span class="comment">/*iso pdb output*/</span>
<a name="l00110"></a>00110                 fout[5] = fopen(par-&gt;<a class="code" href="structs__mdparams.html#19205f0fb04bd26780b7169b5e153d52">f_appdb</a>,<span class="stringliteral">"w"</span>);  <span class="comment">/*all atom -&gt; pocket density output on bfactors*/</span>
<a name="l00111"></a>00111                 timef=fopen(<span class="stringliteral">"time.txt"</span>,<span class="stringliteral">"w"</span>);        <span class="comment">/*performance measurement output*/</span>
<a name="l00112"></a>00112                 <span class="keywordflow">if</span>(fout[1] &amp;&amp; fout[2] &amp;&amp; fout[3] &amp;&amp; fout[4] &amp;&amp; fout[5]) {
<a name="l00113"></a>00113                         <span class="comment">//mdconcat=init_md_concat();  /*alloc &amp; init of the mdconcat structure*/</span>
<a name="l00114"></a>00114                         clock_t b, e ;              <span class="comment">/*for the calculation time measurements*/</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116                         <span class="comment">/* Begins mdpocket */</span>
<a name="l00117"></a>00117                         <span class="keywordflow">for</span>(i = 0 ; i &lt; par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a> ; i++) {
<a name="l00118"></a>00118                                 b = clock() ;       <span class="comment">/*init starting time for this snapshot*/</span>
<a name="l00119"></a>00119                                 fprintf(stdout, <span class="stringliteral">"&lt;mdpocket&gt;s %d/%d - %s:"</span>,
<a name="l00120"></a>00120                                                 i+1, par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>, par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]) ;
<a name="l00121"></a>00121                                 cpdb=<a class="code" href="mdpocket_8c.html#fa4a82c86986d942b9eb16f0ce4ac776">open_pdb_file</a>(par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]);          <span class="comment">/*open the snapshot*/</span>
<a name="l00122"></a>00122                                 <span class="comment">//printf("\navant %d\n",get_number_of_objects_in_memory());</span>
<a name="l00123"></a>00123                                 
<a name="l00124"></a>00124                                 pockets=<a class="code" href="mdpocket_8c.html#3fec6dfd2b4a5dbb7fb8250d9e18a576">mdprocess_pdb</a>(cpdb, par,fout[0],i+1);   <span class="comment">/*perform pocket detection*/</span>
<a name="l00125"></a>00125                                 <span class="keywordflow">if</span>(pockets){
<a name="l00126"></a>00126                                     <span class="keywordflow">if</span>(i==0) {
<a name="l00127"></a>00127                                         freqgrid=<a class="code" href="mdpbase_8c.html#3a661550596173bd65329c1ced46ef06">init_md_grid</a>(pockets);          <span class="comment">/*initialize the md grid, memory allocation*/</span>
<a name="l00128"></a>00128                                         densgrid=<a class="code" href="mdpbase_8c.html#3a661550596173bd65329c1ced46ef06">init_md_grid</a>(pockets);
<a name="l00129"></a>00129                                         refgrid=<a class="code" href="mdpbase_8c.html#3a661550596173bd65329c1ced46ef06">init_md_grid</a>(pockets);
<a name="l00130"></a>00130                                     }
<a name="l00131"></a>00131                                     <span class="keywordflow">else</span> {
<a name="l00132"></a>00132                                         <a class="code" href="mdpbase_8c.html#797f3a7e29293b29134777ed5d0fd30b">reset_grid</a>(refgrid);
<a name="l00133"></a>00133                                     }
<a name="l00134"></a>00134                                     <a class="code" href="mdpbase_8c.html#3662fa60097d0d0eeb5d5c692b3f252b">calculate_md_dens_grid</a>(densgrid,pockets,par);          <span class="comment">// calculate and update mdgrid with voronoi vertice local densities</span>
<a name="l00135"></a>00135                                     <a class="code" href="mdpbase_8c.html#b17b0eaff6d9e3509adec9d37e3ba766">update_md_grid</a>(freqgrid,refgrid,pockets,par);           <span class="comment">//update mdgrid with frequency measurements</span>
<a name="l00136"></a>00136                                 }
<a name="l00137"></a>00137                                 <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb);                           <span class="comment">/*free atoms of the snapshot*/</span>
<a name="l00138"></a>00138                                 <span class="keywordflow">if</span>(i == par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a> - 1) fprintf(stdout,<span class="stringliteral">"\n"</span>);
<a name="l00139"></a>00139                                 <span class="keywordflow">else</span> fprintf(stdout,<span class="stringliteral">"\r"</span>);
<a name="l00140"></a>00140                                 fflush(stdout);
<a name="l00141"></a>00141                                 <a class="code" href="pocket_8c.html#a9afcc69c1f7bdce1f22b0c48397b242">c_lst_pocket_free</a>(pockets);     <span class="comment">/*free pockets of current snapshot*/</span>
<a name="l00142"></a>00142                                 <span class="comment">//printf("\napres %d\n",get_number_of_objects_in_memory());</span>
<a name="l00143"></a>00143                                 <span class="comment">//print_number_of_objects_in_memory();</span>
<a name="l00144"></a>00144                                 e = clock() ;                   <span class="comment">/*snapshot analysis end time*/</span>
<a name="l00145"></a>00145                                 <span class="comment">/*output the time needed for analysis of this snapshots*/</span>
<a name="l00146"></a>00146                                 fprintf(timef,<span class="stringliteral">"%f\n"</span>,((<span class="keywordtype">double</span>)e - b) / CLOCKS_PER_SEC);
<a name="l00147"></a>00147                                 fflush(timef);
<a name="l00148"></a>00148                                 
<a name="l00149"></a>00149 
<a name="l00150"></a>00150                         }
<a name="l00151"></a>00151                         freqgrid-&gt;<a class="code" href="structs__mdgrid.html#7b77c647c68686186aa64afdd9675887">n_snapshots</a>=par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>;
<a name="l00152"></a>00152                         densgrid-&gt;<a class="code" href="structs__mdgrid.html#7b77c647c68686186aa64afdd9675887">n_snapshots</a>=par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154                         <a class="code" href="mdpbase_8c.html#475c8060a73d5cd6cf9e32977e0feac1">normalize_grid</a>(freqgrid,par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>);
<a name="l00155"></a>00155                         <a class="code" href="mdpbase_8c.html#475c8060a73d5cd6cf9e32977e0feac1">normalize_grid</a>(densgrid,par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a>);
<a name="l00156"></a>00156                         cpdb=<a class="code" href="mdpocket_8c.html#fa4a82c86986d942b9eb16f0ce4ac776">open_pdb_file</a>(par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[0]);  <span class="comment">/*open again the first snapshot*/</span>
<a name="l00157"></a>00157                         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(cpdb, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00158"></a>00158                         <a class="code" href="mdpbase_8c.html#d158097a42d8f3d71016a9fdd8cdf125">project_grid_on_atoms</a>(densgrid,cpdb);
<a name="l00159"></a>00159                         <a class="code" href="mdpout_8c.html#3f6818f389384c13cf7cb90a650c0271">write_first_bfactor_density</a>(fout[5],cpdb);
<a name="l00160"></a>00160                         <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb);
<a name="l00161"></a>00161                         <span class="keywordflow">if</span>(par-&gt;<a class="code" href="structs__mdparams.html#97abbd18892f474280256e44bfea5280">bfact_on_all</a>){
<a name="l00162"></a>00162                             <span class="keywordflow">for</span>(i = 0 ; i &lt; par-&gt;<a class="code" href="structs__mdparams.html#eb3c4824845a63d8f3f5f108dce730cd">nfiles</a> ; i++) {
<a name="l00163"></a>00163                                 strcpy(pdb_code, par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]) ;
<a name="l00164"></a>00164                                 <a class="code" href="utils_8c.html#1c104f406d4b5f85b6f0bda8db67536f">remove_ext</a>(pdb_code) ;
<a name="l00165"></a>00165                                 <a class="code" href="utils_8c.html#9096591006dbde3b8c0bca29e6943c4d">remove_path</a>(pdb_code) ;
<a name="l00166"></a>00166                                 sprintf(cf_name, <span class="stringliteral">"%s_out.pdb"</span>, pdb_code) ;
<a name="l00167"></a>00167                                 cf=fopen(cf_name,<span class="stringliteral">"w"</span>);
<a name="l00168"></a>00168                                 cpdb=<a class="code" href="mdpocket_8c.html#fa4a82c86986d942b9eb16f0ce4ac776">open_pdb_file</a>(par-&gt;<a class="code" href="structs__mdparams.html#f50c924a0f40f9b5d79efac63a5469c7">fsnapshot</a>[i]);
<a name="l00169"></a>00169                                 <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(cpdb, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00170"></a>00170                                 <a class="code" href="mdpbase_8c.html#d158097a42d8f3d71016a9fdd8cdf125">project_grid_on_atoms</a>(densgrid,cpdb);
<a name="l00171"></a>00171                                 <a class="code" href="mdpout_8c.html#3f6818f389384c13cf7cb90a650c0271">write_first_bfactor_density</a>(cf,cpdb);
<a name="l00172"></a>00172                                 <a class="code" href="rpdb_8c.html#fda283d39ae56654675e9e858f5ffdea">free_pdb_atoms</a>(cpdb);
<a name="l00173"></a>00173                                 fclose(cf);
<a name="l00174"></a>00174                             }
<a name="l00175"></a>00175                         }
<a name="l00176"></a>00176                        <span class="comment">// fprintf(fout[0],"TER\nEND\n");          /*just to get a good pqr output file*/</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179                      <span class="comment">//   mdconcat-&gt;n_snapshots=par-&gt;nfiles;      /*updata a variable in the mdconcat structure*/</span>
<a name="l00180"></a>00180                      <span class="comment">//   mdgrid=calculate_md_grid(mdconcat);     /*calculate the actual md grid*/</span>
<a name="l00181"></a>00181                         <a class="code" href="mdpout_8c.html#be4f787f6be8208b835d1c129af95ae6">write_md_grid</a>(freqgrid, fout[1],fout[3],par,<a class="code" href="mdparams_8h.html#8f7c7dc32844bb830c3fb5b34fb6e0c6">M_MDP_DEFAULT_ISO_VALUE_FREQ</a>); <span class="comment">/*write the grid to a vmd readable dx file*/</span>
<a name="l00182"></a>00182                         <a class="code" href="mdpout_8c.html#be4f787f6be8208b835d1c129af95ae6">write_md_grid</a>(densgrid, fout[2],fout[4],par,<a class="code" href="mdparams_8h.html#5ba1d4055e3c08937da5f19c6c8bdd69">M_MDP_DEFAULT_ISO_VALUE_DENS</a>); <span class="comment">/*write the grid to a vmd readable dx file*/</span>
<a name="l00183"></a>00183                         <span class="keywordflow">for</span>( i = 1 ; i &lt; 6 ; i++ ) fclose(fout[i]) ;    <span class="comment">/*close all output file handles*/</span>
<a name="l00184"></a>00184                 }
<a name="l00185"></a>00185                 <span class="keywordflow">else</span> {
<a name="l00186"></a>00186                         <span class="comment">/*if(! fout[0]) {</span>
<a name="l00187"></a>00187 <span class="comment">                                fprintf(stdout, "! Output file &lt;%s&gt; couldn't be opened.\n",</span>
<a name="l00188"></a>00188 <span class="comment">                                                par-&gt;f_pqr) ;</span>
<a name="l00189"></a>00189 <span class="comment">                        }</span>
<a name="l00190"></a>00190 <span class="comment">                        else */</span>
<a name="l00191"></a>00191                         <span class="keywordflow">for</span>( i = 1 ; i &lt; 6 ; i++ ){
<a name="l00192"></a>00192                             <span class="keywordflow">if</span> (! fout[i] ) {
<a name="l00193"></a>00193                                 fprintf(stdout, <span class="stringliteral">"! Output file couldn't be opened.\n"</span>);
<a name="l00194"></a>00194                             }
<a name="l00195"></a>00195                         }
<a name="l00196"></a>00196                 }
<a name="l00197"></a>00197                 fclose(timef);      <span class="comment">/*close the performance measurement file handle*/</span>
<a name="l00198"></a>00198                 <span class="comment">/*free_mdconcat(mdconcat);*/</span> <span class="comment">/*should be freed by free_all*/</span>
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3fec6dfd2b4a5dbb7fb8250d9e18a576"></a><!-- doxytag: member="mdpocket.h::mdprocess_pdb" ref="3fec6dfd2b4a5dbb7fb8250d9e18a576" args="(s_pdb *pdb, s_mdparams *mdparams, FILE *pqrout, int snnumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structc__lst__pockets.html">c_lst_pockets</a>* mdprocess_pdb           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__pdb.html">s_pdb</a> *&nbsp;</td>
          <td class="paramname"> <em>pdb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__mdparams.html">s_mdparams</a> *&nbsp;</td>
          <td class="paramname"> <em>mdparams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>pqrout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>snnumber</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: mdprocess_pdb<p>
## SPECIFICATION: Process (fpocket) one snapshot and return all the pockets<p>
## PARAMETRES: @ <a class="el" href="structs__pdb.html">s_pdb</a> *pdb : The current snapshot structure handle @ <a class="el" href="structs__mdparams.html">s_mdparams</a> *mdparams : Parameter structure of the md run @ FILE * pqrout : File handle for the pqr concat output @ int snnumber : Number of the current snapshot<p>
## RETURN: <a class="el" href="structc__lst__pockets.html">c_lst_pockets</a> * : chained list of the fpocket identified pockets on this snapshot 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00460">460</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="mdparams_8h-source.html#l00138">s_mdparams::fpar</a>, <a class="el" href="rpdb_8h-source.html#l00050">M_DONT_KEEP_LIG</a>, <a class="el" href="rpdb_8c-source.html#l00599">rpdb_read()</a>, and <a class="el" href="fpocket_8c-source.html#l00082">search_pocket()</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>, and <a class="el" href="mdpocket_8c-source.html#l00089">mdpocket_detect()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00461"></a>00461 {
<a name="l00462"></a>00462         <a class="code" href="structc__lst__pockets.html">c_lst_pockets</a> *pockets=NULL;
<a name="l00463"></a>00463         <a class="code" href="structs__fparams.html">s_fparams</a> *params=mdparams-&gt;<a class="code" href="structs__mdparams.html#330ea7d574bd29f9925fd7902f74b6c5">fpar</a>;
<a name="l00464"></a>00464         <span class="comment">/* Check the PDB file */</span>
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="keywordflow">if</span>(pdb) {
<a name="l00467"></a>00467                 <span class="comment">/* Actual reading of pdb data and then calculation */</span>
<a name="l00468"></a>00468                         <a class="code" href="rpdb_8c.html#1ec399102f369c72b06a9944616715b0">rpdb_read</a>(pdb, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00469"></a>00469                         
<a name="l00470"></a>00470                         pockets = <a class="code" href="fpocket_8c.html#23faf120fcf6ef1442496cba08d4fbd1">search_pocket</a>(pdb, params,NULL);   <span class="comment">/*run fpocket*/</span>
<a name="l00471"></a>00471                       <span class="comment">//  if(pockets) write_mdpockets_concat_pqr(pqrout,pockets); /*write pqr concat output*/</span>
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         <span class="keywordflow">else</span> fprintf(stderr, <span class="stringliteral">"! PDB reading failed on snapshot %d\n"</span>,snnumber);
<a name="l00474"></a>00474         <span class="keywordflow">return</span> pockets;
<a name="l00475"></a>00475 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fa4a82c86986d942b9eb16f0ce4ac776"></a><!-- doxytag: member="mdpocket.h::open_pdb_file" ref="fa4a82c86986d942b9eb16f0ce4ac776" args="(char *pdbname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__pdb.html">s_pdb</a>* open_pdb_file           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>pdbname</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: open_pdb_file<p>
## SPECIFICATION: Return a pdb structure containing an opened, yet not read pdb file<p>
## PARAMETRES: @ char *pdbname : Name of the pdb file to open<p>
## RETURN: <a class="el" href="structs__pdb.html">s_pdb</a> * : A pdb structure handle of the opened file TODO : place this function in <a class="el" href="rpdb_8c.html">rpdb.c</a> 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00426">426</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="rpdb_8h-source.html#l00050">M_DONT_KEEP_LIG</a>, <a class="el" href="utils_8h-source.html#l00057">M_MAX_PDB_NAME_LEN</a>, and <a class="el" href="rpdb_8c-source.html#l00478">rpdb_open()</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>, and <a class="el" href="mdpocket_8c-source.html#l00089">mdpocket_detect()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00426"></a>00426                                    {
<a name="l00427"></a>00427         <span class="keywordflow">if</span>(pdbname == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordtype">int</span> len = strlen(pdbname) ;
<a name="l00430"></a>00430         <span class="keywordflow">if</span>(len &gt;= <a class="code" href="utils_8h.html#ea69486910da420cbfe816d80ecc8b0c">M_MAX_PDB_NAME_LEN</a> || len &lt;= 0) {
<a name="l00431"></a>00431                 fprintf(stderr, <span class="stringliteral">"! Invalid length for the pdb file name. (Max: %d, Min 1)\n"</span>,
<a name="l00432"></a>00432                                 <a class="code" href="utils_8h.html#ea69486910da420cbfe816d80ecc8b0c">M_MAX_PDB_NAME_LEN</a>) ;
<a name="l00433"></a>00433                 <span class="keywordflow">return</span> NULL;
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="comment">/* Try to open it */</span>
<a name="l00437"></a>00437         <a class="code" href="structs__pdb.html">s_pdb</a> *pdb =  <a class="code" href="rpdb_8c.html#29ed3bff6fdc59fd8bf806a35c3127d7">rpdb_open</a>(pdbname, NULL, <a class="code" href="rpdb_8h.html#067223f2b95bbd02c1861d7d45f393b7">M_DONT_KEEP_LIG</a>) ;
<a name="l00438"></a>00438         <span class="keywordflow">if</span>(pdb) <span class="keywordflow">return</span>(pdb);
<a name="l00439"></a>00439         <span class="keywordflow">return</span> NULL;
<a name="l00440"></a>00440 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b2fe52fe7d891aea86403c98812cbe07"></a><!-- doxytag: member="mdpocket.h::write_md_descriptors" ref="b2fe52fe7d891aea86403c98812cbe07" args="(FILE *f, s_pocket *p, int i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void write_md_descriptors           </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs__pocket.html">s_pocket</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>i</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
## FUNCTION: write_md_descriptors<p>
## SPECIFICATION: Write the md descriptors to the output file<p>
## PARAMETRES: @ FILE *f : file handler of the output file @ <a class="el" href="structs__pocket.html">s_pocket</a> *p : pointer to the md pocket @ int i : integer containing the current snapshot number<p>
## RETURN: void 
<p>Definition at line <a class="el" href="mdpocket_8c-source.html#l00313">313</a> of file <a class="el" href="mdpocket_8c-source.html">mdpocket.c</a>.</p>

<p>References <a class="el" href="descriptors_8h-source.html#l00094">s_desc::aa_compo</a>, <a class="el" href="mdpocket_8h-source.html#l00065">M_MDP_OUTP_FORMAT</a>, <a class="el" href="mdpocket_8h-source.html#l00066">M_MDP_OUTP_VAR</a>, and <a class="el" href="pocket_8h-source.html#l00061">s_pocket::pdesc</a>.</p>

<p>Referenced by <a class="el" href="mdpocket_8c-source.html#l00217">mdpocket_characterize()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00313"></a>00313                                                       {
<a name="l00314"></a>00314     <a class="code" href="structs__desc.html">s_desc</a> *d=p-&gt;<a class="code" href="structs__pocket.html#aba02d3ca1a41adf62ad69884c85fed5">pdesc</a>;
<a name="l00315"></a>00315     fprintf(f, <a class="code" href="mdpocket_8h.html#141569352ac6498ef600013955976332">M_MDP_OUTP_FORMAT</a>, <a class="code" href="mdpocket_8h.html#d0e042551854d85953e19f8610e75ff0">M_MDP_OUTP_VAR</a>(i, d)) ;
<a name="l00316"></a>00316     <span class="keywordtype">int</span> j ;
<a name="l00317"></a>00317     <span class="keywordflow">for</span>(j = 0 ; j &lt; 20 ; j++) fprintf(f, <span class="stringliteral">" %3d"</span>, d-&gt;<a class="code" href="structs__desc.html#12f239c0748ce08dba80fac61722117f">aa_compo</a>[j]) ;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     fprintf(f, <span class="stringliteral">"\n"</span>) ;
<a name="l00320"></a>00320 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 7 16:44:23 2010 for fpocket by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
