<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fpocket: voronoi.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<img src="fpocket_logo_small.png" width="545" height="150">
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>voronoi.c</h1><a href="voronoi_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include "../headers/voronoi.h"</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">/*</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">## GENERAL INFORMATION</span>
<a name="l00007"></a>00007 <span class="comment">##</span>
<a name="l00008"></a>00008 <span class="comment">## FILE                                         voronoi.c</span>
<a name="l00009"></a>00009 <span class="comment">## AUTHORS                                      P. Schmidtke and V. Le Guilloux</span>
<a name="l00010"></a>00010 <span class="comment">## LAST MODIFIED                        02-12-08</span>
<a name="l00011"></a>00011 <span class="comment">##</span>
<a name="l00012"></a>00012 <span class="comment">## SPECIFICATIONS</span>
<a name="l00013"></a>00013 <span class="comment">##</span>
<a name="l00014"></a>00014 <span class="comment">##  Functions dealing with input/output of qhull: we will send to qhull a set</span>
<a name="l00015"></a>00015 <span class="comment">##  of points (basically all atoms of the system), and qhull will send back all</span>
<a name="l00016"></a>00016 <span class="comment">##  voronoi vertices positions. Everything will then be parsed properly for</span>
<a name="l00017"></a>00017 <span class="comment">##  future use.</span>
<a name="l00018"></a>00018 <span class="comment">##</span>
<a name="l00019"></a>00019 <span class="comment">## MODIFICATIONS HISTORY</span>
<a name="l00020"></a>00020 <span class="comment">##</span>
<a name="l00021"></a>00021 <span class="comment">##      02-12-08        (v)  Comments UTD</span>
<a name="l00022"></a>00022 <span class="comment">##      01-04-08        (v)  Added template for comments and creation of history</span>
<a name="l00023"></a>00023 <span class="comment">##      21-02-08        (p)      Adding support for proteins with hydrogens</span>
<a name="l00024"></a>00024 <span class="comment">##      01-01-08        (vp) Created (random date...)</span>
<a name="l00025"></a>00025 <span class="comment">##</span>
<a name="l00026"></a>00026 <span class="comment">## TODO or SUGGESTIONS</span>
<a name="l00027"></a>00027 <span class="comment">##</span>
<a name="l00028"></a>00028 <span class="comment">##  (v) Improve the reading of vertices. Better: include qhull algorithm in our</span>
<a name="l00029"></a>00029 <span class="comment">##              source code.</span>
<a name="l00030"></a>00030 <span class="comment">##  (v) Handle errors when reading/filling vertices..........</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">*/</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment">    COPYRIGHT DISCLAIMER</span>
<a name="l00036"></a>00036 <span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">    Vincent Le Guilloux, Peter Schmidtke and Pierre Tuffery, hereby</span>
<a name="l00038"></a>00038 <span class="comment">        disclaim all copyright interest in the program “fpocket” (which</span>
<a name="l00039"></a>00039 <span class="comment">        performs protein cavity detection) written by Vincent Le Guilloux and Peter</span>
<a name="l00040"></a>00040 <span class="comment">        Schmidtke.</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">    Vincent Le Guilloux  28 November 2008</span>
<a name="l00043"></a>00043 <span class="comment">    Peter Schmidtke      28 November 2008</span>
<a name="l00044"></a>00044 <span class="comment">    Pierre Tuffery       28 November 2008</span>
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">    GNU GPL</span>
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">    This file is part of the fpocket package.</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">    fpocket is free software: you can redistribute it and/or modify</span>
<a name="l00051"></a>00051 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00052"></a>00052 <span class="comment">    the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00053"></a>00053 <span class="comment">    (at your option) any later version.</span>
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">    fpocket is distributed in the hope that it will be useful,</span>
<a name="l00056"></a>00056 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00057"></a>00057 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00058"></a>00058 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00061"></a>00061 <span class="comment">    along with fpocket.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">**/</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#10b382a23c17d4fca5d9ea5be5f36814">fill_vvertices</a>(<a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert, <span class="keyword">const</span> <span class="keywordtype">char</span> fpath[], <a class="code" href="structs__atm.html">s_atm</a> *atoms, <span class="keywordtype">int</span> natoms,
<a name="l00066"></a>00066                                                    <span class="keywordtype">int</span> min_apol_neigh, <span class="keywordtype">float</span> asph_min_size, <span class="keywordtype">float</span> asph_max_size) ;
<a name="l00067"></a>00067 <span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">/**</span>
<a name="l00069"></a>00069 <span class="comment">   ## FUNCTION:</span>
<a name="l00070"></a>00070 <span class="comment">        s_lst_vvertice</span>
<a name="l00071"></a>00071 <span class="comment">  </span>
<a name="l00072"></a>00072 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00073"></a>00073 <span class="comment">        Calculate voronoi vertices using an ensemble of atoms, and then load resulting</span>
<a name="l00074"></a>00074 <span class="comment">        vertices into a s_lst_vvertice structure. The function call an external</span>
<a name="l00075"></a>00075 <span class="comment">        programm qvoronoi, part of qhull programme which can be download at:</span>
<a name="l00076"></a>00076 <span class="comment">                http://www.qhull.org/download/</span>
<a name="l00077"></a>00077 <span class="comment">        or installed with apt-get install qhull-bin</span>
<a name="l00078"></a>00078 <span class="comment">  </span>
<a name="l00079"></a>00079 <span class="comment">   ## PARAMETRES:</span>
<a name="l00080"></a>00080 <span class="comment">        @ s_pdb *pdb          : PDB informations</span>
<a name="l00081"></a>00081 <span class="comment">        @ int min_apol_neigh  : Number of apolar neighbor of a vertice to be</span>
<a name="l00082"></a>00082 <span class="comment">                                                        considered as apolar</span>
<a name="l00083"></a>00083 <span class="comment">        @ float asph_min_size : Minimum size of voronoi vertices to retain</span>
<a name="l00084"></a>00084 <span class="comment">        @ float asph_max_size : Maximum size of voronoi vertices to retain</span>
<a name="l00085"></a>00085 <span class="comment">  </span>
<a name="l00086"></a>00086 <span class="comment">   ## RETURN:</span>
<a name="l00087"></a>00087 <span class="comment">        s_lst_vvertice * :The structure containing the list of vertices.</span>
<a name="l00088"></a>00088 <span class="comment">  </span>
<a name="l00089"></a>00089 <span class="comment">*/</span>
<a name="l00090"></a><a class="code" href="voronoi_8h.html#4d3a0a72e8648578095af06f60c5e66c">00090</a> <a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a>* <a class="code" href="voronoi_8c.html#809199cc4d364b6c7fb2d2d9d21a9510">load_vvertices</a>(<a class="code" href="structs__pdb.html">s_pdb</a> *pdb, <span class="keywordtype">int</span> min_apol_neigh, <span class="keywordtype">float</span> asph_min_size, <span class="keywordtype">float</span> asph_max_size)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092         <span class="keywordtype">int</span> i, nb_h=0;
<a name="l00093"></a>00093         <a class="code" href="structs__atm.html">s_atm</a> *ca = NULL ;
<a name="l00094"></a>00094         <a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert = NULL ;
<a name="l00095"></a>00095         <span class="keywordtype">char</span> tmpn1[250]=<span class="stringliteral">""</span>;
<a name="l00096"></a>00096         <span class="keywordtype">char</span> tmpn2[250]=<span class="stringliteral">""</span>;
<a name="l00097"></a>00097         pid_t pid=getpid();
<a name="l00098"></a>00098         sprintf(tmpn1,<span class="stringliteral">"/tmp/qvoro_tmp_%d.dat"</span>,pid);
<a name="l00099"></a>00099         sprintf(tmpn2,<span class="stringliteral">"/tmp/fpocket_qvor_%d.dat"</span>,pid);
<a name="l00100"></a>00100         FILE *fvoro = fopen(tmpn1, <span class="stringliteral">"w+"</span>);
<a name="l00101"></a>00101         FILE *ftmp=fopen(tmpn2,<span class="stringliteral">"w"</span>);
<a name="l00102"></a>00102         <span class="comment">/*FILE *ftmp=fopen("/tmp/fpocket_qvor.dat","w");</span>
<a name="l00103"></a>00103 <span class="comment">        FILE *fvoro = fopen("/tmp/qvoro_tmp.dat", "w+");*/</span>
<a name="l00104"></a>00104 <span class="comment">/*      lvvert-&gt;h_tr=(int *)my_malloc(sizeof(int));*/</span>
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="keywordflow">if</span>(fvoro != NULL) {
<a name="l00109"></a>00109                 lvvert = (<a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *)<a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a>)) ;
<a name="l00110"></a>00110                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>=NULL;
<a name="l00111"></a>00111                 <span class="comment">/* Loop a first time to get out how many heavy atoms are in the file */</span>
<a name="l00112"></a>00112                 <span class="keywordflow">for</span>(i = 0; i &lt;  pdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a> ; i++){
<a name="l00113"></a>00113                         ca = (pdb-&gt;<a class="code" href="structs__pdb.html#3b0fff968487b66aa1c88e55d45120e4">latoms</a>)+i ;
<a name="l00114"></a>00114                         <span class="keywordflow">if</span>(strcmp(ca-&gt;<a class="code" href="structs__atm.html#c80daffa94edeadd30433f6653e08054">symbol</a>,<span class="stringliteral">"H"</span>)) {
<a name="l00115"></a>00115                                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>=(<span class="keywordtype">int</span> *)<a class="code" href="memhandler_8c.html#ede15d67c845c05e9b2bfb59b8ab6cf7">my_realloc</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(i-nb_h+1)) ;
<a name="l00116"></a>00116                                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[i-nb_h]=i ;
<a name="l00117"></a>00117                         }
<a name="l00118"></a>00118                         <span class="keywordflow">else</span> nb_h++;
<a name="l00119"></a>00119                 }
<a name="l00120"></a>00120                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#8e4c0be6b621ade71df924faf66fbd82">n_h_tr</a>=i-nb_h;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122                 <span class="comment">/* Write the header for qvoronoi */</span>
<a name="l00123"></a>00123                 fprintf(fvoro,<span class="stringliteral">"3 rbox D3\n%d\n"</span>, lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#8e4c0be6b621ade71df924faf66fbd82">n_h_tr</a>);
<a name="l00124"></a>00124                 <span class="comment">/* Loop a second time for the qvoronoi input coordinates */</span>
<a name="l00125"></a>00125                 <span class="keywordflow">for</span>(i = 0; i &lt;  pdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a> ; i++){
<a name="l00126"></a>00126                         ca = (pdb-&gt;<a class="code" href="structs__pdb.html#3b0fff968487b66aa1c88e55d45120e4">latoms</a>)+i ;
<a name="l00127"></a>00127                         <span class="keywordflow">if</span>(strcmp(ca-&gt;<a class="code" href="structs__atm.html#c80daffa94edeadd30433f6653e08054">symbol</a>,<span class="stringliteral">"H"</span>)) {
<a name="l00128"></a>00128                         <span class="comment">/* Only if this is a heavy atom export it for voronoi tesselation,</span>
<a name="l00129"></a>00129 <span class="comment">                         * else discard it */</span>
<a name="l00130"></a>00130                                 fprintf(fvoro,<span class="stringliteral">"%f %f %f \n"</span>, ca-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, ca-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, ca-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>);
<a name="l00131"></a>00131                         }
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134                 fflush(fvoro) ;
<a name="l00135"></a>00135                 rewind(fvoro);
<a name="l00136"></a>00136                 
<a name="l00137"></a>00137                 <span class="comment">//int status = system("qvoronoi p i Pp Fn &lt; voro_tmp.dat &gt; voro.tmp") ;</span>
<a name="l00138"></a>00138         run_qvoronoi(fvoro,ftmp);
<a name="l00139"></a>00139         <span class="keywordtype">int</span> status=<a class="code" href="voronoi_8h.html#beb4af6653b4d1cb89cb62f3cf87cf17">M_VORONOI_SUCCESS</a>;
<a name="l00140"></a>00140                 
<a name="l00141"></a>00141                 fclose(fvoro) ;
<a name="l00142"></a>00142 <span class="comment">/*        fclose(fvoro);*/</span>
<a name="l00143"></a>00143                 
<a name="l00144"></a>00144         <span class="keyword">remove</span>(tmpn1);
<a name="l00145"></a>00145                 <span class="keywordflow">if</span>(status == <a class="code" href="voronoi_8h.html#beb4af6653b4d1cb89cb62f3cf87cf17">M_VORONOI_SUCCESS</a>) {
<a name="l00146"></a>00146                         <a class="code" href="voronoi_8c.html#10b382a23c17d4fca5d9ea5be5f36814">fill_vvertices</a>(lvvert, tmpn2, pdb-&gt;<a class="code" href="structs__pdb.html#3b0fff968487b66aa1c88e55d45120e4">latoms</a>, pdb-&gt;<a class="code" href="structs__pdb.html#85aaf7bdb931bb303af1ca736a998b98">natoms</a>,
<a name="l00147"></a>00147                                                         min_apol_neigh, asph_min_size, asph_max_size);
<a name="l00148"></a>00148                 }
<a name="l00149"></a>00149                 <span class="keywordflow">else</span> {
<a name="l00150"></a>00150                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert);
<a name="l00151"></a>00151                         lvvert = NULL ;
<a name="l00152"></a>00152                         fprintf(stderr, <span class="stringliteral">"! Voronoi command failed with status %d...\n"</span>, status) ;
<a name="l00153"></a>00153                 }
<a name="l00154"></a>00154         <span class="keyword">remove</span>(tmpn2);
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         <span class="keywordflow">else</span> {
<a name="l00157"></a>00157                 fprintf(stderr, <span class="stringliteral">"! File for Voronoi vertices calculation couldn't be opened...\n"</span>) ;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         
<a name="l00160"></a>00160         <span class="keywordflow">return</span> lvvert ;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 <span class="comment"></span>
<a name="l00163"></a>00163 <span class="comment">/**</span>
<a name="l00164"></a>00164 <span class="comment">   ## FUNCTION:</span>
<a name="l00165"></a>00165 <span class="comment">        fill_vertices</span>
<a name="l00166"></a>00166 <span class="comment">  </span>
<a name="l00167"></a>00167 <span class="comment">   ## PARAMETRES:</span>
<a name="l00168"></a>00168 <span class="comment">        @ s_lst_vvertice *lvvert : The structure to fill</span>
<a name="l00169"></a>00169 <span class="comment">        @ const char fpath[]     : File containing vertices</span>
<a name="l00170"></a>00170 <span class="comment">        @ s_atm *atoms           : List of atoms</span>
<a name="l00171"></a>00171 <span class="comment">        @ int natoms             : Number of atoms</span>
<a name="l00172"></a>00172 <span class="comment">        @ int min_apol_neigh  : Number of apolar neighbor of a vertice to be</span>
<a name="l00173"></a>00173 <span class="comment">                                                        considered as apolar</span>
<a name="l00174"></a>00174 <span class="comment">        @ float asph_min_size : Minimum size of voronoi vertices to retain</span>
<a name="l00175"></a>00175 <span class="comment">        @ float asph_max_size : Maximum size of voronoi vertices to retain</span>
<a name="l00176"></a>00176 <span class="comment">  </span>
<a name="l00177"></a>00177 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00178"></a>00178 <span class="comment">        Fill structure given in argument (must have been allocated) using a file</span>
<a name="l00179"></a>00179 <span class="comment">        containing vertice coordinates and neighbours using p i options of qhull.</span>
<a name="l00180"></a>00180 <span class="comment">  </span>
<a name="l00181"></a>00181 <span class="comment">   ## RETURN:</span>
<a name="l00182"></a>00182 <span class="comment">        void</span>
<a name="l00183"></a>00183 <span class="comment">  </span>
<a name="l00184"></a>00184 <span class="comment">*/</span>
<a name="l00185"></a><a class="code" href="voronoi_8c.html#10b382a23c17d4fca5d9ea5be5f36814">00185</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#10b382a23c17d4fca5d9ea5be5f36814">fill_vvertices</a>(<a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert, <span class="keyword">const</span> <span class="keywordtype">char</span> fpath[], <a class="code" href="structs__atm.html">s_atm</a> *atoms, <span class="keywordtype">int</span> natoms,
<a name="l00186"></a>00186                                                    <span class="keywordtype">int</span> min_apol_neigh, <span class="keywordtype">float</span> asph_min_size, <span class="keywordtype">float</span> asph_max_size)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188         FILE *f = NULL ;        <span class="comment">/* File handler for vertices coordinates */</span>
<a name="l00189"></a>00189         FILE *fNb = NULL ;      <span class="comment">/* File handler for vertices atomic neighbours */</span>
<a name="l00190"></a>00190         FILE *fvNb = NULL;      <span class="comment">/* File handler for vertices vertice neighbours */</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <a class="code" href="structs__vvertice.html">s_vvertice</a> *v = NULL ;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="keywordtype">float</span> tmpRay;   <span class="comment">/* Temporary Ray of voronoi vertice (ray of alpha sphere) */</span>
<a name="l00195"></a>00195         <span class="keywordtype">float</span> xyz[3] = {0,0,0};
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="keywordtype">int</span> i, j,nchar_max = 255,
<a name="l00198"></a>00198                 vInMem = 0,                             <span class="comment">/* Saved vertices counter */</span>
<a name="l00199"></a>00199                 curLineNb = 0,                  <span class="comment">/* Current line number */</span>
<a name="l00200"></a>00200                 trash = 0,
<a name="l00201"></a>00201                 tmpApolar=0,
<a name="l00202"></a>00202                 curVnbIdx[4],                   <span class="comment">/* Current vertice neighbours */</span>
<a name="l00203"></a>00203                 curNbIdx[4];                    <span class="comment">/* Current atomic neighbours */</span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="keywordtype">char</span> cline[nchar_max],
<a name="l00206"></a>00206                  nbline[nchar_max],
<a name="l00207"></a>00207                  vNbline[nchar_max],
<a name="l00208"></a>00208                  *s_nvert = (<span class="keywordtype">char</span> *) <a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*nchar_max) ;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/* Once we have the number of lines, lets allocate memory and get the lines */</span>
<a name="l00211"></a>00211        
<a name="l00212"></a>00212         f = fopen(fpath,<span class="stringliteral">"r"</span>) ;
<a name="l00213"></a>00213         fNb = fopen(fpath,<span class="stringliteral">"r"</span>) ;
<a name="l00214"></a>00214         fvNb = fopen(fpath,<span class="stringliteral">"r"</span>) ;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="keywordtype">char</span> *status = NULL ;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         status = fgets(cline, nchar_max, f) ;           <span class="comment">/* Skip fir=st line */</span>
<a name="l00219"></a>00219         status = fgets(cline, nchar_max, f) ;           <span class="comment">/* Load 2nd line containing nbr of coors. */</span>
<a name="l00220"></a>00220         status = fgets(nbline, nchar_max, fNb) ;        <span class="comment">/* Skip first line */</span>
<a name="l00221"></a>00221         status = fgets(nbline, nchar_max, fNb) ;        <span class="comment">/* Load 2nd line containing nbr of coors. */</span>
<a name="l00222"></a>00222         status = fgets(vNbline, nchar_max, fvNb) ;      <span class="comment">/* Skip first line */</span>
<a name="l00223"></a>00223         status = fgets(vNbline, nchar_max, fvNb) ;      <span class="comment">/* Load 2nd line containing nbr of coors. */</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         sscanf(cline,<span class="stringliteral">"%d"</span>,&amp;(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>)) ;
<a name="l00226"></a>00226         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#253abfa820e0656ea637951d6c4fb378">qhullSize</a> = lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a> ;
<a name="l00227"></a>00227         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a> = (<span class="keywordtype">int</span> *) <a class="code" href="memhandler_8c.html#52d7260a38c396cb2dd1dd7abcfd61cb">my_malloc</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00228"></a>00228         <span class="keywordflow">for</span>(i = 0 ; i &lt; lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a> ; i++) lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a>[i] = -1;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a> = (<a class="code" href="structs__vvertice.html">s_vvertice</a> *) <a class="code" href="memhandler_8c.html#e1a54755aeeb11b927875d686a5248c7">my_calloc</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>, <span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>)) ;
<a name="l00231"></a>00231         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a>= (<a class="code" href="structs__vvertice.html">s_vvertice</a> **) <a class="code" href="memhandler_8c.html#e1a54755aeeb11b927875d686a5248c7">my_calloc</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>, <span class="keyword">sizeof</span>(<a class="code" href="structs__vvertice.html">s_vvertice</a>*)) ;
<a name="l00232"></a>00232         
<a name="l00233"></a>00233         <span class="comment">/* Get the string of number of vertices to read, to look up the neighbour</span>
<a name="l00234"></a>00234 <span class="comment">         * list from qhull */</span>
<a name="l00235"></a>00235         sprintf(s_nvert,<span class="stringliteral">"%d"</span>,lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>);
<a name="l00236"></a>00236         strcat(s_nvert,<span class="stringliteral">"\n"</span>);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="comment">/* Advance cursor to neighbour list */</span>
<a name="l00239"></a>00239         <span class="keywordflow">while</span>(fgets(nbline, nchar_max, fNb) != NULL &amp;&amp; strcmp(s_nvert, nbline) != 0) ;
<a name="l00240"></a>00240         <span class="comment">/* Advance cursor to the vertice neighbour list */</span>
<a name="l00241"></a>00241         <span class="keywordflow">while</span>(fgets(vNbline,nchar_max,fvNb) != NULL &amp;&amp; curLineNb++ &lt; lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>*2+1) ;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         i = 0 ;
<a name="l00244"></a>00244         <span class="keywordflow">while</span>(fgets(cline, nchar_max, f) != NULL) {
<a name="l00245"></a>00245         <span class="comment">/* Read vertice positions */</span>
<a name="l00246"></a>00246                 <span class="keywordflow">if</span>(fgets(nbline, nchar_max,fNb)!=NULL){
<a name="l00247"></a>00247                 <span class="comment">/* Read neighbours */</span>
<a name="l00248"></a>00248                         <span class="keywordflow">if</span>(fgets(vNbline, nchar_max,fvNb)!=NULL){
<a name="l00249"></a>00249                         <span class="comment">/* Read vertice neighbour vertices */</span>
<a name="l00250"></a>00250                                 <span class="keywordflow">if</span>(strcmp(<span class="stringliteral">"\n"</span>, cline) != 0 &amp;&amp; strcmp(<span class="stringliteral">"\n"</span>, nbline) != 0
<a name="l00251"></a>00251                                    &amp;&amp; strcmp(<span class="stringliteral">"\n"</span>, vNbline) != 0) {
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                                         sscanf(cline,<span class="stringliteral">"%f %f %f"</span>,&amp;xyz[0], &amp;xyz[1], &amp;xyz[2]);
<a name="l00254"></a>00254                                         sscanf(nbline,<span class="stringliteral">"%d %d %d %d"</span>,&amp;curNbIdx[0],&amp;curNbIdx[1],
<a name="l00255"></a>00255                                                                                                 &amp;curNbIdx[2],&amp;curNbIdx[3]);
<a name="l00256"></a>00256                                         sscanf(vNbline,<span class="stringliteral">"%d %d %d %d %d"</span>, &amp;trash, &amp;curVnbIdx[0],
<a name="l00257"></a>00257                                                                                                          &amp;curVnbIdx[1],
<a name="l00258"></a>00258                                                                                                          &amp;curVnbIdx[2], &amp;curVnbIdx[3]);
<a name="l00259"></a>00259                                 <span class="comment">/* Test voro. vert. for alpha sphere cond. and returns ray if</span>
<a name="l00260"></a>00260 <span class="comment">                                 * cond. are ok, -1 else */</span>
<a name="l00261"></a>00261                                         tmpRay = <a class="code" href="voronoi_8c.html#ff07f3be2fee9344d3fcecd3b18aac62">testVvertice</a>(xyz, curNbIdx, atoms, asph_min_size,
<a name="l00262"></a>00262                                                                                   asph_max_size,lvvert);
<a name="l00263"></a>00263                                         <span class="keywordflow">if</span>(tmpRay &gt; 0){
<a name="l00264"></a>00264                                                 v = (lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a> + vInMem) ;
<a name="l00265"></a>00265                                                 v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> = xyz[0]; v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> = xyz[1]; v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> = xyz[2];
<a name="l00266"></a>00266                                                 v-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> = tmpRay;
<a name="l00267"></a>00267                                                 v-&gt;<a class="code" href="structs__vvertice.html#a47fae81830953dca2c9262abc8ff876">sort_x</a> = -1 ;
<a name="l00268"></a>00268                                                 v-&gt;<a class="code" href="structs__vvertice.html#00f72ba072dc86c5e55096c2dace01f2">seen</a> = 0 ;
<a name="l00269"></a>00269                                                 
<a name="l00270"></a>00270                                                 tmpApolar=0;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272                                                 <span class="keywordflow">for</span>(j = 0 ; j &lt; 4 ; j++) {
<a name="l00273"></a>00273                                                         v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[j] = &amp;(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[j]]]);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                                                         <span class="keywordflow">if</span>(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[j]]].<a class="code" href="structs__atm.html#f41b525ee3032d47baf2db10387f022c">electroneg</a>&lt;2.8) tmpApolar++ ;
<a name="l00276"></a>00276                                                         <span class="keywordflow">if</span>(curVnbIdx[j]&gt;0) v-&gt;<a class="code" href="structs__vvertice.html#9c86938784eb3b8d55ae3280cbe63544">vneigh</a>[j] = curVnbIdx[j];
<a name="l00277"></a>00277                                                 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                                                 v-&gt;<a class="code" href="structs__vvertice.html#cc3432bcb24b87e4a5d8878cbf0f57c6">apol_neighbours</a> = 0 ;
<a name="l00280"></a>00280                                                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a>[i] = vInMem ;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282                                                 lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a>[vInMem] = v ;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                                                 vInMem++ ;              <span class="comment">/* Vertices actually read */</span>
<a name="l00285"></a>00285                                                 v-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a> = natoms+i+1-vInMem ;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                                                 <span class="keywordflow">if</span>(tmpApolar &gt;= min_apol_neigh) v-&gt;<a class="code" href="structs__vvertice.html#7cd4bd55a93f3400449ef354b49bb4c3">type</a> = <a class="code" href="voronoi_8h.html#e90a1520c3ca5a4b829d387d4d06b004">M_APOLAR_AS</a>;
<a name="l00288"></a>00288                                                 <span class="keywordflow">else</span> v-&gt;<a class="code" href="structs__vvertice.html#7cd4bd55a93f3400449ef354b49bb4c3">type</a> = <a class="code" href="voronoi_8h.html#235175bd6aa1a2a3b3d35e6e4445365e">M_POLAR_AS</a>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                                                 v-&gt;<a class="code" href="structs__vvertice.html#76424289943949999297e6263919bdeb">qhullId</a> = i;         <span class="comment">/* Set index in the qhull file */</span>
<a name="l00291"></a>00291                                                 v-&gt;<a class="code" href="structs__vvertice.html#54bc1b392d46ab9a9a1ec164c1a2b431">resid</a> = -1;          <span class="comment">/* Initialize internal index */</span>
<a name="l00292"></a>00292                                                 <a class="code" href="voronoi_8c.html#0cffdb4ff10d2af2fbdc139b7b789c06">set_barycenter</a>(v) ;     <span class="comment">/* Set barycentre */</span>
<a name="l00293"></a>00293                                         }
<a name="l00294"></a>00294                                         i++ ;
<a name="l00295"></a>00295                                 }
<a name="l00296"></a>00296                         }
<a name="l00297"></a>00297                 }
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a>=vInMem ;
<a name="l00301"></a>00301         fclose(f) ;
<a name="l00302"></a>00302         fclose(fNb) ;
<a name="l00303"></a>00303         fclose(fvNb);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 <span class="comment"></span>
<a name="l00306"></a>00306 <span class="comment">/**</span>
<a name="l00307"></a>00307 <span class="comment">   ## FUNCTION:</span>
<a name="l00308"></a>00308 <span class="comment">        set_barycenter</span>
<a name="l00309"></a>00309 <span class="comment">  </span>
<a name="l00310"></a>00310 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00311"></a>00311 <span class="comment">        Set barycenter of a vertice using it's 4 contacting atoms.</span>
<a name="l00312"></a>00312 <span class="comment">  </span>
<a name="l00313"></a>00313 <span class="comment">   ## PARAMETERS:</span>
<a name="l00314"></a>00314 <span class="comment">        @ s_vvertice *v: The vertice</span>
<a name="l00315"></a>00315 <span class="comment">  </span>
<a name="l00316"></a>00316 <span class="comment">   ## RETURN: void</span>
<a name="l00317"></a>00317 <span class="comment">  </span>
<a name="l00318"></a>00318 <span class="comment">*/</span>
<a name="l00319"></a><a class="code" href="voronoi_8h.html#0cffdb4ff10d2af2fbdc139b7b789c06">00319</a> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#0cffdb4ff10d2af2fbdc139b7b789c06">set_barycenter</a>(<a class="code" href="structs__vvertice.html">s_vvertice</a> *v)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321         <span class="keywordtype">int</span> i ;
<a name="l00322"></a>00322         <span class="keywordtype">float</span> xsum = 0.0,
<a name="l00323"></a>00323                   ysum = 0.0,
<a name="l00324"></a>00324                   zsum = 0.0 ;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <span class="keywordflow">for</span>(i = 0 ; i &lt; 4 ; i++) {
<a name="l00327"></a>00327                 xsum += v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[i]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a> ;
<a name="l00328"></a>00328                 ysum += v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[i]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ;
<a name="l00329"></a>00329                 zsum += v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[i]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a> ;
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         v-&gt;<a class="code" href="structs__vvertice.html#158f2fc12fef57205ad4f951bf20caea">bary</a>[0] = xsum*0.25 ;
<a name="l00333"></a>00333         v-&gt;<a class="code" href="structs__vvertice.html#158f2fc12fef57205ad4f951bf20caea">bary</a>[1] = ysum*0.25 ;
<a name="l00334"></a>00334         v-&gt;<a class="code" href="structs__vvertice.html#158f2fc12fef57205ad4f951bf20caea">bary</a>[2] = zsum*0.25 ;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 <span class="comment"></span>
<a name="l00338"></a>00338 <span class="comment">/**</span>
<a name="l00339"></a>00339 <span class="comment">   ## FUNCTION:</span>
<a name="l00340"></a>00340 <span class="comment">        testVvertice</span>
<a name="l00341"></a>00341 <span class="comment">  </span>
<a name="l00342"></a>00342 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00343"></a>00343 <span class="comment">        Test if alpha sphere conditions are fulfilled for current vertice</span>
<a name="l00344"></a>00344 <span class="comment">  </span>
<a name="l00345"></a>00345 <span class="comment">   ## PARAMETERS:</span>
<a name="l00346"></a>00346 <span class="comment">        @ float xyz[3]        : Coordinates of current vertice</span>
<a name="l00347"></a>00347 <span class="comment">        @ int curNbIdx[4]     : Indexes of atomic neighbours of the current vertice</span>
<a name="l00348"></a>00348 <span class="comment">        @ s_atm *atoms        : List of all atoms</span>
<a name="l00349"></a>00349 <span class="comment">        @ float min_asph_size : Minimum size of alpha spheres.</span>
<a name="l00350"></a>00350 <span class="comment">        @ float max_asph_size : Maximum size of alpha spheres.</span>
<a name="l00351"></a>00351 <span class="comment">  </span>
<a name="l00352"></a>00352 <span class="comment">   ## RETURN:</span>
<a name="l00353"></a>00353 <span class="comment">        float : -1 if conditions are not fulfilled, else the alpha sphere radius</span>
<a name="l00354"></a>00354 <span class="comment">                    is returned.</span>
<a name="l00355"></a>00355 <span class="comment">  </span>
<a name="l00356"></a>00356 <span class="comment">*/</span>
<a name="l00357"></a><a class="code" href="voronoi_8h.html#ff07f3be2fee9344d3fcecd3b18aac62">00357</a> <span class="keywordtype">float</span> <a class="code" href="voronoi_8c.html#ff07f3be2fee9344d3fcecd3b18aac62">testVvertice</a>(<span class="keywordtype">float</span> xyz[3], <span class="keywordtype">int</span> curNbIdx[4], <a class="code" href="structs__atm.html">s_atm</a> *atoms,
<a name="l00358"></a>00358                                    <span class="keywordtype">float</span> min_asph_size, <span class="keywordtype">float</span> max_asph_size,
<a name="l00359"></a>00359                                    <a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert)
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361         <span class="keywordtype">float</span> x = xyz[0],
<a name="l00362"></a>00362                   y = xyz[1],
<a name="l00363"></a>00363                   z = xyz[2] ;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <a class="code" href="structs__atm.html">s_atm</a> *cura = &amp;(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[0]]]) ;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         <span class="keywordtype">float</span> distVatom1 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(x, y, z, cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>) ;
<a name="l00368"></a>00368         <span class="keywordtype">float</span> distVatom2,
<a name="l00369"></a>00369                   distVatom3,
<a name="l00370"></a>00370                   distVatom4;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="keywordflow">if</span>(min_asph_size &lt;= distVatom1  &amp;&amp; distVatom1 &lt;= max_asph_size){
<a name="l00373"></a>00373                 cura = &amp;(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[1]]]) ;
<a name="l00374"></a>00374                 distVatom2 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(x, y, z, cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 cura = &amp;(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[2]]]) ;
<a name="l00377"></a>00377                 distVatom3 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(x, y, z, cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379                 cura = &amp;(atoms[lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>[curNbIdx[3]]]) ;
<a name="l00380"></a>00380                 distVatom4=<a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(x, y, z, cura-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, cura-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, cura-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                 <span class="comment">/* Test if all 4 neighbours are on the alpha sphere surface</span>
<a name="l00383"></a>00383 <span class="comment">                 * (approximate test) */</span>
<a name="l00384"></a>00384                 <span class="keywordflow">if</span>(fabs(distVatom1-distVatom2) &lt; <a class="code" href="voronoi_8h.html#9a3c197b6aed2e738902d35219c94c61">M_PREC_TOLERANCE</a> &amp;&amp;
<a name="l00385"></a>00385                    fabs(distVatom1-distVatom3)  &lt; <a class="code" href="voronoi_8h.html#9a3c197b6aed2e738902d35219c94c61">M_PREC_TOLERANCE</a> &amp;&amp;
<a name="l00386"></a>00386                    fabs(distVatom1-distVatom4) &lt; <a class="code" href="voronoi_8h.html#9a3c197b6aed2e738902d35219c94c61">M_PREC_TOLERANCE</a>){
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                         <span class="keywordflow">return</span> distVatom1;
<a name="l00389"></a>00389                 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392         <span class="keywordflow">return</span> -1.0;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 <span class="comment"></span>
<a name="l00395"></a>00395 <span class="comment">/**</span>
<a name="l00396"></a>00396 <span class="comment">   ## FUNCTION:</span>
<a name="l00397"></a>00397 <span class="comment">        print_vvertices</span>
<a name="l00398"></a>00398 <span class="comment">  </span>
<a name="l00399"></a>00399 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00400"></a>00400 <span class="comment">        Print function.</span>
<a name="l00401"></a>00401 <span class="comment">  </span>
<a name="l00402"></a>00402 <span class="comment">   ## PARAMETERS:</span>
<a name="l00403"></a>00403 <span class="comment">        @ FILE *f                : Buffer to print in</span>
<a name="l00404"></a>00404 <span class="comment">        @ s_lst_vvertice *lvvert : Vertices to print</span>
<a name="l00405"></a>00405 <span class="comment">  </span>
<a name="l00406"></a>00406 <span class="comment">   ## RETURN: void</span>
<a name="l00407"></a>00407 <span class="comment">  </span>
<a name="l00408"></a>00408 <span class="comment">*/</span>
<a name="l00409"></a><a class="code" href="voronoi_8h.html#0268e8ccbb2743b5e94e398a094644aa">00409</a> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#0268e8ccbb2743b5e94e398a094644aa">print_vvertices</a>(FILE *f, <a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411         <span class="keywordflow">if</span>(lvvert) {
<a name="l00412"></a>00412                 <span class="keywordflow">if</span>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a>) {
<a name="l00413"></a>00413                         <span class="keywordtype">int</span> i ;
<a name="l00414"></a>00414                         <span class="keywordflow">for</span>(i = 0 ; i &lt; lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#c6b07ac45ca65ccd944b68afd4c18bfb">nvert</a> ; i++) {
<a name="l00415"></a>00415                                 <a class="code" href="structs__vvertice.html">s_vvertice</a> *v = &amp;(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a>[i]) ;
<a name="l00416"></a>00416                                 <span class="keywordflow">if</span>( v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0] &amp;&amp;  v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1] &amp;&amp; v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2] &amp;&amp;  v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]) {
<a name="l00417"></a>00417                                         fprintf(f, <span class="stringliteral">"====== Vertice %d: =====\n"</span>, i);
<a name="l00418"></a>00418                                         fprintf(f, <span class="stringliteral">"- x = %f, y = %f, z = %f\n"</span>, v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>);
<a name="l00419"></a>00419                                         fprintf(f, <span class="stringliteral">"- ix = %d\n"</span>,v-&gt;<a class="code" href="structs__vvertice.html#a47fae81830953dca2c9262abc8ff876">sort_x</a>);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                                         <span class="keywordtype">float</span> d1 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>) ;
<a name="l00422"></a>00422                                         <span class="keywordtype">float</span> d2 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>) ;
<a name="l00423"></a>00423                                         <span class="keywordtype">float</span> d3 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>) ;
<a name="l00424"></a>00424                                         <span class="keywordtype">float</span> d4 = <a class="code" href="calc_8c.html#615f3353fc9ccc88069adb4000b21e73">dist</a>(v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>) ;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                                         fprintf(f, <span class="stringliteral">"- Neighbour: \n1 - %f (%f %f %f: %d) \n2 - %f (%f %f %f: %d)\n3 - %f (%f %f %f: %d)\n4 - %f (%f %f %f: %d)\n"</span>, d1, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[0]-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>, d2, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[1]-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>, d3, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>,  v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a> ,  v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[2]-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>, d4, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#2bf748fbcd9b6d0a472b292a6b244ed5">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#72534af707e830760a209fec348bc1af">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#f7cae749a2d07ffb393317f12745170a">z</a>, v-&gt;<a class="code" href="structs__vvertice.html#d8f82150ff5b05ee09b1136a9c09cfd0">neigh</a>[3]-&gt;<a class="code" href="structs__atm.html#88237f06aa7a10cd6b382c19b800f230">id</a>);
<a name="l00427"></a>00427                                 }
<a name="l00428"></a>00428                         }
<a name="l00429"></a>00429                 }
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 <span class="comment"></span>
<a name="l00433"></a>00433 <span class="comment">/**</span>
<a name="l00434"></a>00434 <span class="comment">   ## FUNCTION:</span>
<a name="l00435"></a>00435 <span class="comment">        get_verts_volume_ptr</span>
<a name="l00436"></a>00436 <span class="comment">  </span>
<a name="l00437"></a>00437 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00438"></a>00438 <span class="comment">        Get an monte carlo approximation of the volume occupied by the alpha spheres</span>
<a name="l00439"></a>00439 <span class="comment">        given in argument (list of pointers)</span>
<a name="l00440"></a>00440 <span class="comment">  </span>
<a name="l00441"></a>00441 <span class="comment">   ## PARAMETRES:</span>
<a name="l00442"></a>00442 <span class="comment">        @ s_vvertice **verts: List of pointer to alpha spheres</span>
<a name="l00443"></a>00443 <span class="comment">        @ int nvert: Number of spheres</span>
<a name="l00444"></a>00444 <span class="comment">        @ int niter: Number of monte carlo iteration to perform</span>
<a name="l00445"></a>00445 <span class="comment">        @ float correct: radius for which the size of an alpha sphere should be </span>
<a name="l00446"></a>00446 <span class="comment">          corrected in order to calculate the volume</span>
<a name="l00447"></a>00447 <span class="comment">  </span>
<a name="l00448"></a>00448 <span class="comment">   ## RETURN:</span>
<a name="l00449"></a>00449 <span class="comment">        float: volume.</span>
<a name="l00450"></a>00450 <span class="comment">  </span>
<a name="l00451"></a>00451 <span class="comment">*/</span>
<a name="l00452"></a><a class="code" href="voronoi_8h.html#621631ed13a0e6d72412f1551969a655">00452</a> <span class="keywordtype">float</span> <a class="code" href="voronoi_8c.html#621631ed13a0e6d72412f1551969a655">get_verts_volume_ptr</a>(<a class="code" href="structs__vvertice.html">s_vvertice</a> **verts, <span class="keywordtype">int</span> nvert, <span class="keywordtype">int</span> niter,<span class="keywordtype">float</span> correct)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454         <span class="keywordtype">int</span> i = 0, j = 0,
<a name="l00455"></a>00455                 nb_in = 0;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="keywordtype">float</span> xmin = 0.0, xmax = 0.0,
<a name="l00458"></a>00458                   ymin = 0.0, ymax = 0.0,
<a name="l00459"></a>00459                   zmin = 0.0, zmax = 0.0,
<a name="l00460"></a>00460                   xtmp = 0.0, ytmp = 0.0, ztmp = 0.0,
<a name="l00461"></a>00461                   xr   = 0.0, yr   = 0.0, zr   = 0.0,
<a name="l00462"></a>00462                   vbox = 0.0 ;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464         <a class="code" href="structs__vvertice.html">s_vvertice</a> *vcur = NULL ;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="comment">/* First, search extrems coordinates to get a contour box of the molecule */</span>
<a name="l00467"></a>00467         <span class="keywordflow">for</span>(i = 0 ; i &lt; nvert ; i++) {
<a name="l00468"></a>00468                 vcur = verts[i] ;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                 <span class="keywordflow">if</span>(i == 0) {
<a name="l00471"></a>00471                         xmin = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ; xmax = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ;
<a name="l00472"></a>00472                         ymin = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ; ymax = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ;
<a name="l00473"></a>00473                         zmin = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ; zmax = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct ;
<a name="l00474"></a>00474                 }
<a name="l00475"></a>00475                 <span class="keywordflow">else</span> {
<a name="l00476"></a>00476                 <span class="comment">/* Update the minimum and maximum extreme point */</span>
<a name="l00477"></a>00477                         <span class="keywordflow">if</span>(xmin &gt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) xmin = xtmp ;
<a name="l00478"></a>00478                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(xmax &lt; (xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) xmax = xtmp ;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480                         <span class="keywordflow">if</span>(ymin &gt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) ymin = ytmp ;
<a name="l00481"></a>00481                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ymax &lt; (ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) ymax = ytmp ;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                         <span class="keywordflow">if</span>(zmin &gt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) zmin = ztmp ;
<a name="l00484"></a>00484                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(zmax &lt; (ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> + vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) zmax = ztmp ;
<a name="l00485"></a>00485                 }
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="comment">/* Next calculate the contour box volume */</span>
<a name="l00489"></a>00489         vbox = (xmax - xmin)*(ymax - ymin)*(zmax - zmin) ;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <span class="comment">/* Then apply monte carlo approximation of the volume.   */</span>
<a name="l00492"></a>00492         <span class="keywordflow">for</span>(i = 0 ; i &lt; niter ; i++) {
<a name="l00493"></a>00493                 xr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(xmin, xmax) ;
<a name="l00494"></a>00494                 yr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(ymin, ymax) ;
<a name="l00495"></a>00495                 zr = <a class="code" href="utils_8c.html#5492196e16ed2d16bae1df8483ef79ed">rand_uniform</a>(zmin, zmax) ;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497                 <span class="keywordflow">for</span>(j = 0 ; j &lt; nvert ; j++) {
<a name="l00498"></a>00498                         vcur = verts[j] ;
<a name="l00499"></a>00499                         xtmp = vcur-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a> - xr ;
<a name="l00500"></a>00500                         ytmp = vcur-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a> - yr ;
<a name="l00501"></a>00501                         ztmp = vcur-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a> - zr ;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503                 <span class="comment">/* Compare r^2 and dist(center, random_point)^2 */</span>
<a name="l00504"></a>00504                         <span class="keywordflow">if</span>(((correct+vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>)*(vcur-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a> + correct)) &gt; (xtmp*xtmp + ytmp*ytmp + ztmp*ztmp)) {
<a name="l00505"></a>00505                         <span class="comment">/* The point is inside one of the vertice!! */</span>
<a name="l00506"></a>00506                                 nb_in ++ ; break ;
<a name="l00507"></a>00507                         }
<a name="l00508"></a>00508                 }
<a name="l00509"></a>00509         }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511         <span class="comment">/* Ok lets just return the volume Vpok = Nb_in/Niter*Vbox */</span>
<a name="l00512"></a>00512         <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)nb_in)/((float)niter)*vbox;
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 <span class="comment"></span>
<a name="l00515"></a>00515 <span class="comment">/**</span>
<a name="l00516"></a>00516 <span class="comment">   ## FUNCTION:</span>
<a name="l00517"></a>00517 <span class="comment">        free_vert_lst</span>
<a name="l00518"></a>00518 <span class="comment">  </span>
<a name="l00519"></a>00519 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00520"></a>00520 <span class="comment">        Free memory</span>
<a name="l00521"></a>00521 <span class="comment">  </span>
<a name="l00522"></a>00522 <span class="comment">   ## PARAMETERS:</span>
<a name="l00523"></a>00523 <span class="comment">        @ s_lst_vvertice *lvvert : Data to free</span>
<a name="l00524"></a>00524 <span class="comment">  </span>
<a name="l00525"></a>00525 <span class="comment">   ## RETURN: void</span>
<a name="l00526"></a>00526 <span class="comment">  </span>
<a name="l00527"></a>00527 <span class="comment">*/</span>
<a name="l00528"></a><a class="code" href="voronoi_8h.html#5d8ea86290bf16a736c4ae0bdd9b0baa">00528</a> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#5d8ea86290bf16a736c4ae0bdd9b0baa">free_vert_lst</a>(<a class="code" href="structs__lst__vvertice.html">s_lst_vvertice</a> *lvvert)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530         <span class="keywordflow">if</span>(lvvert) {
<a name="l00531"></a>00531                 <span class="keywordflow">if</span>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a>) {
<a name="l00532"></a>00532                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a>) ;
<a name="l00533"></a>00533                         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#81f278e6754408ea7de3a0f5d7aca6dc">vertices</a> = NULL ;
<a name="l00534"></a>00534                 }
<a name="l00535"></a>00535                 <span class="keywordflow">if</span>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a>) {
<a name="l00536"></a>00536                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a>) ;
<a name="l00537"></a>00537                         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#638d9ede844bca411ed99cb8e22b0e56">pvertices</a> = NULL ;
<a name="l00538"></a>00538                 }
<a name="l00539"></a>00539                 <span class="keywordflow">if</span>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a>) {
<a name="l00540"></a>00540                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a>) ;
<a name="l00541"></a>00541                         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#d7a495083cb4d89a4775007fb1ad3115">tr</a> = NULL ;
<a name="l00542"></a>00542                 }
<a name="l00543"></a>00543                 <span class="keywordflow">if</span>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>) {
<a name="l00544"></a>00544                         <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a>) ;
<a name="l00545"></a>00545                         lvvert-&gt;<a class="code" href="structs__lst__vvertice.html#7ab1882e21a9060b6317df7e49fbfa5f">h_tr</a> = NULL ;
<a name="l00546"></a>00546                 }
<a name="l00547"></a>00547                 <a class="code" href="memhandler_8c.html#a49400242a007d208c641f79856ea4c6">my_free</a>(lvvert) ;
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 <span class="comment"></span>
<a name="l00551"></a>00551 <span class="comment">/**</span>
<a name="l00552"></a>00552 <span class="comment">   ## FUNCTION:</span>
<a name="l00553"></a>00553 <span class="comment">        is_in_lst_vert</span>
<a name="l00554"></a>00554 <span class="comment">  </span>
<a name="l00555"></a>00555 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00556"></a>00556 <span class="comment">        Says wether a vertice of id v_id is in a list of vertices or not</span>
<a name="l00557"></a>00557 <span class="comment">  </span>
<a name="l00558"></a>00558 <span class="comment">   ## PARAMETRES:</span>
<a name="l00559"></a>00559 <span class="comment">  </span>
<a name="l00560"></a>00560 <span class="comment">   ## RETURN:</span>
<a name="l00561"></a>00561 <span class="comment">        1 if the vertice is in the tab, 0 if not</span>
<a name="l00562"></a>00562 <span class="comment">  </span>
<a name="l00563"></a>00563 <span class="comment">*/</span>
<a name="l00564"></a><a class="code" href="voronoi_8h.html#e3ecf2620f9bec82cc0180c2efd5c091">00564</a> <span class="keywordtype">int</span> <a class="code" href="voronoi_8c.html#e3ecf2620f9bec82cc0180c2efd5c091">is_in_lst_vert</a>(<a class="code" href="structs__vvertice.html">s_vvertice</a> **lst_vert, <span class="keywordtype">int</span> nb_vert, <span class="keywordtype">int</span> v_id)
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566         <span class="keywordtype">int</span> i ;
<a name="l00567"></a>00567         <span class="keywordflow">for</span>(i = 0 ; i &lt; nb_vert ; i++) {
<a name="l00568"></a>00568                 <span class="keywordflow">if</span>(v_id == lst_vert[i]-&gt;<span class="keywordtype">id</span>) <span class="keywordflow">return</span> 1 ;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="keywordflow">return</span> 0 ;
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 <span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment">/**</span>
<a name="l00575"></a>00575 <span class="comment">   ## FUNCTION:</span>
<a name="l00576"></a>00576 <span class="comment">        is_in_lst_vert</span>
<a name="l00577"></a>00577 <span class="comment">  </span>
<a name="l00578"></a>00578 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00579"></a>00579 <span class="comment">        Says wether a vertice of id v_id is in a list of vertices or not</span>
<a name="l00580"></a>00580 <span class="comment">  </span>
<a name="l00581"></a>00581 <span class="comment">   ## PARAMETRES:</span>
<a name="l00582"></a>00582 <span class="comment">  </span>
<a name="l00583"></a>00583 <span class="comment">   ## RETURN:</span>
<a name="l00584"></a>00584 <span class="comment">        1 if the vertice is in the tab, 0 if not</span>
<a name="l00585"></a>00585 <span class="comment">  </span>
<a name="l00586"></a>00586 <span class="comment">*/</span>
<a name="l00587"></a><a class="code" href="voronoi_8h.html#8553105087cea62c70a4c33d4f18aa96">00587</a> <span class="keywordtype">int</span> <a class="code" href="voronoi_8c.html#8553105087cea62c70a4c33d4f18aa96">is_in_lst_vert_p</a>(<a class="code" href="structs__vvertice.html">s_vvertice</a> **lst_vert, <span class="keywordtype">int</span> nb_vert, <a class="code" href="structs__vvertice.html">s_vvertice</a> *vert)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589         <span class="keywordtype">int</span> i ;
<a name="l00590"></a>00590         <span class="keywordflow">for</span>(i = 0 ; i &lt; nb_vert ; i++) {
<a name="l00591"></a>00591                 <span class="keywordflow">if</span>(vert == lst_vert[i]) <span class="keywordflow">return</span> 1 ;
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <span class="keywordflow">return</span> 0 ;
<a name="l00595"></a>00595 }<span class="comment"></span>
<a name="l00596"></a>00596 <span class="comment">/**</span>
<a name="l00597"></a>00597 <span class="comment">        --</span>
<a name="l00598"></a>00598 <span class="comment">        --</span>
<a name="l00599"></a>00599 <span class="comment"></span>
<a name="l00600"></a>00600 <span class="comment">        OUTPUT FUNCTIONS</span>
<a name="l00601"></a>00601 <span class="comment"></span>
<a name="l00602"></a>00602 <span class="comment">        --</span>
<a name="l00603"></a>00603 <span class="comment">        --</span>
<a name="l00604"></a>00604 <span class="comment">        --</span>
<a name="l00605"></a>00605 <span class="comment">*/</span>
<a name="l00606"></a>00606 <span class="comment"></span>
<a name="l00607"></a>00607 <span class="comment">/**</span>
<a name="l00608"></a>00608 <span class="comment">   ## FUNCTION:</span>
<a name="l00609"></a>00609 <span class="comment">        void write_pdb_vertice(FILE *f, s_vvertice *v)</span>
<a name="l00610"></a>00610 <span class="comment">  </span>
<a name="l00611"></a>00611 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00612"></a>00612 <span class="comment">        Write a voronoi vertice in pdb format.</span>
<a name="l00613"></a>00613 <span class="comment">  </span>
<a name="l00614"></a>00614 <span class="comment">   ## PARAMETRES:</span>
<a name="l00615"></a>00615 <span class="comment">        @ FILE *f: file to write in</span>
<a name="l00616"></a>00616 <span class="comment">        @ s_vvertice *v: The vertice</span>
<a name="l00617"></a>00617 <span class="comment">  </span>
<a name="l00618"></a>00618 <span class="comment">   ## RETURN:</span>
<a name="l00619"></a>00619 <span class="comment">  </span>
<a name="l00620"></a>00620 <span class="comment">*/</span>
<a name="l00621"></a><a class="code" href="voronoi_8h.html#624ae3215f4659770cd761d5bbb70a39">00621</a> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#624ae3215f4659770cd761d5bbb70a39">write_pdb_vert</a>(FILE *f, <a class="code" href="structs__vvertice.html">s_vvertice</a> *v)
<a name="l00622"></a>00622 {
<a name="l00623"></a>00623         <span class="keywordflow">if</span>(v-&gt;<a class="code" href="structs__vvertice.html#7cd4bd55a93f3400449ef354b49bb4c3">type</a>==<a class="code" href="voronoi_8h.html#e90a1520c3ca5a4b829d387d4d06b004">M_APOLAR_AS</a>) <a class="code" href="writepdb_8c.html#c1826cac257476a6fe47825b31cafb4d">write_pdb_atom_line</a>(f, <span class="stringliteral">"HETATM"</span>, v-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>, <span class="stringliteral">"APOL"</span>,
<a name="l00624"></a>00624                                                                                                  <span class="charliteral">' '</span>, <span class="stringliteral">"STP"</span>, <span class="stringliteral">"C"</span>, v-&gt;<a class="code" href="structs__vvertice.html#54bc1b392d46ab9a9a1ec164c1a2b431">resid</a>, <span class="charliteral">' '</span>,
<a name="l00625"></a>00625                                                                                                  v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, 0.0, 0.0,
<a name="l00626"></a>00626                                                                                                  <span class="stringliteral">"Ve"</span>, -1);
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="keywordflow">else</span> <a class="code" href="writepdb_8c.html#c1826cac257476a6fe47825b31cafb4d">write_pdb_atom_line</a>(f, <span class="stringliteral">"HETATM"</span>, v-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>, <span class="stringliteral">" POL"</span>, <span class="charliteral">' '</span>, <span class="stringliteral">"STP"</span>, <span class="stringliteral">"C"</span>,
<a name="l00629"></a>00629                                                                 v-&gt;<a class="code" href="structs__vvertice.html#54bc1b392d46ab9a9a1ec164c1a2b431">resid</a>, <span class="charliteral">' '</span>,v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>,0.0, 0.0,
<a name="l00630"></a>00630                                                                 <span class="stringliteral">"Ve"</span>, -1);
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 <span class="comment"></span>
<a name="l00633"></a>00633 <span class="comment">/**</span>
<a name="l00634"></a>00634 <span class="comment">   ## FUNCTION:</span>
<a name="l00635"></a>00635 <span class="comment">        write_pqr_vertice</span>
<a name="l00636"></a>00636 <span class="comment">  </span>
<a name="l00637"></a>00637 <span class="comment">   ## SPECIFICATION:</span>
<a name="l00638"></a>00638 <span class="comment">        Write a voronoi vertice in pqr format.</span>
<a name="l00639"></a>00639 <span class="comment">  </span>
<a name="l00640"></a>00640 <span class="comment">   ## PARAMETRES:</span>
<a name="l00641"></a>00641 <span class="comment">        @ FILE *f       : file to write in</span>
<a name="l00642"></a>00642 <span class="comment">        @ s_vvertice *v : The vertice</span>
<a name="l00643"></a>00643 <span class="comment">  </span>
<a name="l00644"></a>00644 <span class="comment">   ## RETURN:</span>
<a name="l00645"></a>00645 <span class="comment">        void</span>
<a name="l00646"></a>00646 <span class="comment">  </span>
<a name="l00647"></a>00647 <span class="comment">*/</span>
<a name="l00648"></a><a class="code" href="voronoi_8h.html#0fc0360fbb0a071ba6d49dedd57ba397">00648</a> <span class="keywordtype">void</span> <a class="code" href="voronoi_8c.html#0fc0360fbb0a071ba6d49dedd57ba397">write_pqr_vert</a>(FILE *f, <a class="code" href="structs__vvertice.html">s_vvertice</a> *v)
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650         <span class="keywordflow">if</span>(v-&gt;<a class="code" href="structs__vvertice.html#7cd4bd55a93f3400449ef354b49bb4c3">type</a>==<a class="code" href="voronoi_8h.html#e90a1520c3ca5a4b829d387d4d06b004">M_APOLAR_AS</a>) <a class="code" href="writepdb_8c.html#92a5b208994d6b1cd8db116c93a158ac">write_pqr_atom_line</a>(f, <span class="stringliteral">"ATOM"</span>, v-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>, <span class="stringliteral">"APOL"</span>, <span class="charliteral">' '</span>,
<a name="l00651"></a>00651                                                                                                  <span class="stringliteral">"STP"</span>, <span class="stringliteral">" "</span>, v-&gt;<a class="code" href="structs__vvertice.html#54bc1b392d46ab9a9a1ec164c1a2b431">resid</a>, <span class="charliteral">' '</span>,
<a name="l00652"></a>00652                                                                                                   v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>, 0.0, v-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="keywordflow">else</span> <a class="code" href="writepdb_8c.html#92a5b208994d6b1cd8db116c93a158ac">write_pqr_atom_line</a>(f, <span class="stringliteral">"ATOM"</span>, v-&gt;<a class="code" href="structs__vvertice.html#e66571bccd6d8e3f809b4315fdcbf65e">id</a>, <span class="stringliteral">" POL"</span>, <span class="charliteral">' '</span>, <span class="stringliteral">"STP"</span>, <span class="stringliteral">" "</span>,
<a name="l00655"></a>00655                                                          v-&gt;<a class="code" href="structs__vvertice.html#54bc1b392d46ab9a9a1ec164c1a2b431">resid</a>, <span class="charliteral">' '</span>,v-&gt;<a class="code" href="structs__vvertice.html#017f9695c923d87d851231bf13967b22">x</a>, v-&gt;<a class="code" href="structs__vvertice.html#250642d688398e4186819f63d54247bc">y</a>, v-&gt;<a class="code" href="structs__vvertice.html#3e03d11fd3b1d0ffb623481fa1b497b6">z</a>,0.0, v-&gt;<a class="code" href="structs__vvertice.html#0aadc589bd2213f3c6246e873cc69a83">ray</a>);
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Jul 5 22:10:40 2009 for fpocket by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
